(function(c){var f=(function(){if(!c.browser.msie){return false}var j=document.createElement("div");try{j.style.setExpression("width","0+0")}catch(h){return false}return true})();function e(h,j){return parseInt(c.css(h,j))||0}function b(h){var h=parseInt(h).toString(16);return(h.length<2)?"0"+h:h}function g(k){for(;k&&k.nodeName.toLowerCase()!="html";k=k.parentNode){var h=c.css(k,"backgroundColor");if(h=="rgba(0, 0, 0, 0)"){continue}if(h.indexOf("rgb")>=0){var j=h.match(/\d+/g);return"#"+b(j[0])+b(j[1])+b(j[2])}if(h&&h!="transparent"){return h}}return"#ffffff"}function a(k,h,j){switch(k){case"round":return Math.round(j*(1-Math.cos(Math.asin(h/j))));case"cool":return Math.round(j*(1+Math.cos(Math.asin(h/j))));case"sharp":return Math.round(j*(1-Math.cos(Math.acos(h/j))));case"bite":return Math.round(j*(Math.cos(Math.asin((j-h-1)/j))));case"slide":return Math.round(j*(Math.atan2(h,j/h)));case"jut":return Math.round(j*(Math.atan2(j,(j-h-1))));case"curl":return Math.round(j*(Math.atan(h)));case"tear":return Math.round(j*(Math.cos(h)));case"wicked":return Math.round(j*(Math.tan(h)));case"long":return Math.round(j*(Math.sqrt(h)));case"sculpt":return Math.round(j*(Math.log((j-h-1),j)));case"dog":return(h&1)?(h+1):j;case"dog2":return(h&2)?(h+1):j;case"dog3":return(h&3)?(h+1):j;case"fray":return(h%2)*j;case"notch":return j;case"bevel":return h+1}}c.fn.corner=function(m){if(this.length==0){if(!c.isReady&&this.selector){var v=this.selector,r=this.context;c(function(){c(v,r).corner(m)})}return this}m=(m||"").toLowerCase();var j=/keep/.test(m);var n=((m.match(/cc:(#[0-9a-f]+)/)||[])[1]);var t=((m.match(/sc:(#[0-9a-f]+)/)||[])[1]);var l=parseInt((m.match(/(\d+)px/)||[])[1])||10;var u=/round|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dog/;var p=((m.match(u)||["round"])[0]);var q={T:0,B:1};var h={TL:/top|tl/.test(m),TR:/top|tr/.test(m),BL:/bottom|bl/.test(m),BR:/bottom|br/.test(m)};if(!h.TL&&!h.TR&&!h.BL&&!h.BR){h={TL:1,TR:1,BL:1,BR:1}}var k=document.createElement("div");k.style.overflow="hidden";k.style.height="1px";k.style.backgroundColor=t||"transparent";k.style.borderStyle="solid";return this.each(function(z){var s={T:parseInt(c.css(this,"paddingTop"))||0,R:parseInt(c.css(this,"paddingRight"))||0,B:parseInt(c.css(this,"paddingBottom"))||0,L:parseInt(c.css(this,"paddingLeft"))||0};if(typeof this.style.zoom!=undefined){this.style.zoom=1}if(!j){this.style.border="none"}k.style.borderColor=n||g(this.parentNode);var B=c.curCSS(this,"height");for(var x in q){var C=q[x];if((C&&(h.BL||h.BR))||(!C&&(h.TL||h.TR))){k.style.borderStyle="none "+(h[x+"R"]?"solid":"none")+" none "+(h[x+"L"]?"solid":"none");var D=document.createElement("div");c(D).addClass("jquery-corner");var o=D.style;C?this.appendChild(D):this.insertBefore(D,this.firstChild);if(C&&B!="auto"){if(c.css(this,"position")=="static"){this.style.position="relative"}o.position="absolute";o.bottom=o.left=o.padding=o.margin="0";if(f){o.setExpression("width","this.parentNode.offsetWidth")}else{o.width="100%"}}else{if(!C&&c.browser.msie){if(c.css(this,"position")=="static"){this.style.position="relative"}o.position="absolute";o.top=o.left=o.right=o.padding=o.margin="0";if(f){var E=e(this,"borderLeftWidth")+e(this,"borderRightWidth");o.setExpression("width","this.parentNode.offsetWidth - "+E+'+ "px"')}else{o.width="100%"}}else{o.margin=!C?"-"+s.T+"px -"+s.R+"px "+(s.T-l)+"px -"+s.L+"px":(s.B-l)+"px -"+s.R+"px -"+s.B+"px -"+s.L+"px"}}for(var y=0;y<l;y++){var F=Math.max(0,a(p,y,l));var A=k.cloneNode(false);A.style.borderWidth="0 "+(h[x+"R"]?F:0)+"px 0 "+(h[x+"L"]?F:0)+"px";C?D.appendChild(A):D.insertBefore(A,D.firstChild)}}}})};c.fn.uncorner=function(){c("div.jquery-corner",this).remove();return this}})(jQuery);(function(a){a.fn.addOption=function(){var j=function(m,s,u,q){var p;var r=true;if(!m.cache){m.cache={}}var l=m.options;var k=l.length;for(var n=0;n<k;n++){if(!m.cache[l[n].value]){m.cache[l[n].value]=n}if(l[n].value==s){p=l[n];r=false}}if(typeof p=="undefined"){p=document.createElement("option");p.value=s}p.text=u;if(typeof m.cache[s]=="undefined"){m.cache[s]=k}if(r){m.options[m.cache[s]]=p}if(q){p.selected=true}};var c=arguments;if(c.length==0){return this}var h=true;var b=false;var f,e,g;if(typeof(c[0])=="object"){b=true;f=c[0]}if(c.length>=2){if(typeof(c[1])=="boolean"){h=c[1]}else{if(typeof(c[2])=="boolean"){h=c[2]}}if(!b){e=c[0];g=c[1]}}this.each(function(){if(this.nodeName.toLowerCase()!="select"){return}if(b){for(var k in f){j(this,k,f[k],h)}}else{j(this,e,g,h)}});return this};a.fn.ajaxAddOption=function(e,g,b,f,c){if(typeof(e)!="string"){return this}if(typeof(g)!="object"){g={}}if(typeof(b)!="boolean"){b=true}this.each(function(){var h=this;a.getJSON(e,g,function(j){a(h).addOption(j,b);if(typeof f=="function"){if(typeof c=="object"){f.apply(h,c)}else{f.call(h)}}})});return this};a.fn.removeOption=function(){var c=arguments;if(c.length==0){return this}var f=typeof(c[0]);var e,g;if(f=="string"||f=="object"||f=="function"){e=c[0];if(e.constructor==Array){var b=e.length;for(var h=0;h<b;h++){this.removeOption(e[h],c[1])}return this}}else{if(f=="number"){g=c[0]}else{return this}}this.each(function(){if(this.nodeName.toLowerCase()!="select"){return}if(this.cache){this.cache=null}var j=false;var m=this.options;if(!!e){var k=m.length;for(var l=k-1;l>=0;l--){if(e.constructor==RegExp){if(m[l].value.match(e)){j=true}}else{if(m[l].value==e){j=true}}if(j&&c[1]===true){j=m[l].selected}if(j){m[l]=null}j=false}}else{if(c[1]===true){j=m[g].selected}else{j=true}if(j){this.remove(g)}}});return this};a.fn.sortOptions=function(c){var e=a(this).selectedValues();var b=typeof(c)=="undefined"?true:!!c;this.each(function(){if(this.nodeName.toLowerCase()!="select"){return}var h=this.options;var f=h.length;var j=[];for(var g=0;g<f;g++){j[g]={v:h[g].value,t:h[g].text}}j.sort(function(l,k){o1t=l.t.toLowerCase(),o2t=k.t.toLowerCase();if(o1t==o2t){return 0}if(b){return o1t<o2t?-1:1}else{return o1t>o2t?-1:1}});for(var g=0;g<f;g++){h[g].text=j[g].t;h[g].value=j[g].v}}).selectOptions(e,true);return this};a.fn.selectOptions=function(f,b){var e=f;var h=typeof(f);if(h=="object"&&e.constructor==Array){var g=this;a.each(e,function(){g.selectOptions(this,b)})}var j=b||false;if(h!="string"&&h!="function"&&h!="object"){return this}this.each(function(){if(this.nodeName.toLowerCase()!="select"){return this}var l=this.options;var c=l.length;for(var k=0;k<c;k++){if(e.constructor==RegExp){if(l[k].value.match(e)){l[k].selected=true}else{if(j){l[k].selected=false}}}else{if(l[k].value==e){l[k].selected=true}else{if(j){l[k].selected=false}}}}});return this};a.fn.copyOptions=function(e,c){var b=c||"selected";if(a(e).size()==0){return this}this.each(function(){if(this.nodeName.toLowerCase()!="select"){return this}var h=this.options;var f=h.length;for(var g=0;g<f;g++){if(b=="all"||(b=="selected"&&h[g].selected)){a(e).addOption(h[g].value,h[g].text)}}});return this};a.fn.containsOption=function(f,c){var e=false;var b=f;var g=typeof(b);var h=typeof(c);if(g!="string"&&g!="function"&&g!="object"){return h=="function"?this:e}this.each(function(){if(this.nodeName.toLowerCase()!="select"){return this}if(e&&h!="function"){return false}var l=this.options;var j=l.length;for(var k=0;k<j;k++){if(b.constructor==RegExp){if(l[k].value.match(b)){e=true;if(h=="function"){c.call(l[k],k)}}}else{if(l[k].value==b){e=true;if(h=="function"){c.call(l[k],k)}}}}});return h=="function"?this:e};a.fn.selectedValues=function(){var b=[];this.selectedOptions().each(function(){b[b.length]=this.value});return b};a.fn.selectedTexts=function(){var b=[];this.selectedOptions().each(function(){b[b.length]=this.text});return b};a.fn.selectedOptions=function(){return this.find("option:selected")}})(jQuery);(function(a){a.fn.hoverIntent=function(m,l){var n={sensitivity:7,interval:100,timeout:0};n=a.extend(n,l?{over:m,out:l}:m);var p,o,j,e;var h=function(f){p=f.pageX;o=f.pageY};var c=function(g,f){f.hoverIntent_t=clearTimeout(f.hoverIntent_t);if((Math.abs(j-p)+Math.abs(e-o))<n.sensitivity){a(f).unbind("mousemove",h);f.hoverIntent_s=1;return n.over.apply(f,[g])}else{j=p;e=o;f.hoverIntent_t=setTimeout(function(){c(g,f)},n.interval)}};var k=function(g,f){f.hoverIntent_t=clearTimeout(f.hoverIntent_t);f.hoverIntent_s=0;return n.out.apply(f,[g])};var b=function(r){var q=(r.type=="mouseover"?r.fromElement:r.toElement)||r.relatedTarget;while(q&&q!=this){try{q=q.parentNode}catch(r){q=this}}if(q==this){return false}var g=jQuery.extend({},r);var f=this;if(f.hoverIntent_t){f.hoverIntent_t=clearTimeout(f.hoverIntent_t)}if(r.type=="mouseover"){j=g.pageX;e=g.pageY;a(f).bind("mousemove",h);if(f.hoverIntent_s!=1){f.hoverIntent_t=setTimeout(function(){c(g,f)},n.interval)}}else{a(f).unbind("mousemove",h);if(f.hoverIntent_s==1){f.hoverIntent_t=setTimeout(function(){k(g,f)},n.timeout)}}};return this.mouseover(b).mouseout(b)}})(jQuery);(function(a){var b=function(c){var g=null,f=a("#"+c),e=a("input[name="+c+"]");if(f!==undefined){g=f}else{if(e!==undefined){g=e}}return g};a.fn.autotab_magic=function(c){for(var e=0;e<this.length;e++){var g=e+1,f=e-1;if(e>0&&g<this.length){a(this[e]).autotab({target:a(this[g]),previous:a(this[f])})}else{if(e>0){a(this[e]).autotab({previous:a(this[f])})}else{a(this[e]).autotab({target:a(this[g])})}}if(c!==null&&(isNaN(c)&&c==a(this[e]).attr("id"))||(!isNaN(c)&&c==e)){a(this[e]).focus()}}};a.fn.autotab_filter=function(c){var f={format:"all",uppercase:false,lowercase:false,nospace:false,pattern:null};if(typeof c=="string"||typeof c=="function"){f.format=c}else{a.extend(f,c)}for(var e=0;e<this.length;e++){a(this[e]).bind("keyup",function(h){var j=this.value,g;switch(f.format){case"text":g=new RegExp("[0-9]+","g");j=j.replace(g,"");break;case"alpha":g=new RegExp("[^a-zA-Z]+","g");j=j.replace(g,"");break;case"number":case"numeric":g=new RegExp("[^0-9]+","g");j=j.replace(g,"");break;case"alphanumeric":g=new RegExp("[^0-9a-zA-Z]+","g");j=j.replace(g,"");break;case"custom":g=new RegExp(f.pattern,"g");j=j.replace(g,"");break;default:if(typeof f.format=="function"){j=f.format(j)}break}if(f.nospace){g=new RegExp("[ ]+","g");j=j.replace(g,"")}if(f.uppercase){j=j.toUpperCase()}if(f.lowercase){j=j.toLowerCase()}if(j!=this.value){this.value=j}})}};a.fn.autotab=function(c){var g={format:"all",maxlength:2147483647,uppercase:false,lowercase:false,nospace:false,target:null,previous:null,pattern:null},e=a(this).attr("maxlength"),f=[8,9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46,144,145];a.extend(g,c);if(typeof g.target=="string"){g.target=b(g.target)}if(typeof g.previous=="string"){g.previous=b(g.previous)}if(g.maxlength==2147483647&&e!=2147483647){g.maxlength=e}else{if(g.maxlength>0){a(this).attr("maxlength",g.maxlength)}else{g.target=null}}if(g.format!="all"){a(this).autotab_filter(g)}return a(this).bind("keydown",function(h){if(h.which==8&&this.value.length===0&&g.previous){g.previous.focus().val(g.previous.val())}}).bind("keyup",function(h){if(h.which!=8){var j=a(this).val();if(a.inArray(h.which,f)==-1&&j.length==g.maxlength&&g.target){g.target.focus()}}})}})(jQuery);(function(b){var a=null;b.fn.autogrow=function(c){return this.each(function(){new b.autogrow(this,c)})};b.autogrow=function(c,f){this.options=f||{};this.dummy=null;this.interval=null;this.line_height=this.options.lineHeight||parseInt(b(c).css("line-height"));this.min_height=this.options.minHeight||parseInt(b(c).css("min-height"));this.max_height=this.options.maxHeight||parseInt(b(c).css("max-height"));this.textarea=b(c);if(this.line_height==NaN){this.line_height=0}this.init()};b.autogrow.fn=b.autogrow.prototype={autogrow:"1.2.2"};b.autogrow.fn.extend=b.autogrow.extend=b.extend;b.autogrow.fn.extend({init:function(){var c=this;this.textarea.css({overflow:"hidden",display:"block"});this.textarea.bind("focus",function(){c.startExpand()}).bind("blur",function(){c.stopExpand()});this.checkExpand()},startExpand:function(){var c=this;this.interval=window.setInterval(function(){c.checkExpand()},400)},stopExpand:function(){clearInterval(this.interval)},checkExpand:function(){if(this.dummy==null){this.dummy=b("<div></div>");this.dummy.css({"font-size":this.textarea.css("font-size"),"font-family":this.textarea.css("font-family"),width:this.textarea.css("width"),padding:this.textarea.css("padding"),"line-height":this.line_height+"px","overflow-x":"hidden",position:"absolute",top:0,left:-9999}).appendTo("body")}var c=this.textarea.val().replace(/(<|>)/g,"");if($.browser.msie){c=c.replace(/\n/g,"<BR>new")}else{c=c.replace(/\n/g,"<br>new")}if(this.dummy.html()!=c){this.dummy.html(c);if(this.max_height>0&&(this.dummy.height()+this.line_height>this.max_height)){this.textarea.css("overflow-y","auto")}else{this.textarea.css("overflow-y","hidden");if(this.textarea.height()<this.dummy.height()+this.line_height||(this.dummy.height()<this.textarea.height())){this.textarea.animate({height:(this.dummy.height())+"px"},100)}}}}})})(jQuery);(function(a){a.fn.lorem=function(e){a.fn.lorem.defaults={type:"paragraphs",amount:"3",ptags:true};var h=a.extend({},a.fn.lorem.defaults,e);var b=1;var c=10;var k=c-b+1;var j=h.amount;var g=new Array(10);g[1]="Nam quis nulla. Integer malesuada. In in enim a arcu imperdiet malesuada. Sed vel lectus. Donec odio urna, tempus molestie, porttitor ut, iaculis quis, sem. Phasellus rhoncus. Aenean id metus id velit ullamcorper pulvinar. Vestibulum fermentum tortor id mi. Pellentesque ipsum. Nulla non arcu lacinia neque faucibus fringilla. Nulla non lectus sed nisl molestie malesuada. Proin in tellus sit amet nibh dignissim sagittis. Vivamus luctus egestas leo. Maecenas sollicitudin. Nullam rhoncus aliquam metus. Etiam egestas wisi a erat.";g[2]="Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Nullam feugiat, turpis at pulvinar vulputate, erat libero tristique tellus, nec bibendum odio risus sit amet ante. Aliquam erat volutpat. Nunc auctor. Mauris pretium quam et urna. Fusce nibh. Duis risus. Curabitur sagittis hendrerit ante. Aliquam erat volutpat. Vestibulum erat nulla, ullamcorper nec, rutrum non, nonummy ac, erat. Duis condimentum augue id magna semper rutrum. Nullam justo enim, consectetuer nec, ullamcorper ac, vestibulum in, elit. Proin pede metus, vulputate nec, fermentum fringilla, vehicula vitae, justo. Fusce consectetuer risus a nunc. Aliquam ornare wisi eu metus. Integer pellentesque quam vel velit. Duis pulvinar.";g[3]="Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Morbi gravida libero nec velit. Morbi scelerisque luctus velit. Etiam dui sem, fermentum vitae, sagittis id, malesuada in, quam. Proin mattis lacinia justo. Vestibulum facilisis auctor urna. Aliquam in lorem sit amet leo accumsan lacinia. Integer rutrum, orci vestibulum ullamcorper ultricies, lacus quam ultricies odio, vitae placerat pede sem sit amet enim. Phasellus et lorem id felis nonummy placerat. Fusce dui leo, imperdiet in, aliquam sit amet, feugiat eu, orci. Aenean vel massa quis mauris vehicula lacinia. Quisque tincidunt scelerisque libero. Maecenas libero. Etiam dictum tincidunt diam. Donec ipsum massa, ullamcorper in, auctor et, scelerisque sed, est. Suspendisse nisl. Sed convallis magna eu sem. Cras pede libero, dapibus nec, pretium sit amet, tempor quis, urna.";g[4]="Etiam posuere quam ac quam. Maecenas aliquet accumsan leo. Nullam dapibus fermentum ipsum. Etiam quis quam. Integer lacinia. Nulla est. Nulla turpis magna, cursus sit amet, suscipit a, interdum id, felis. Integer vulputate sem a nibh rutrum consequat. Maecenas lorem. Pellentesque pretium lectus id turpis. Etiam sapien elit, consequat eget, tristique non, venenatis quis, ante. Fusce wisi. Phasellus faucibus molestie nisl. Fusce eget urna. Curabitur vitae diam non enim vestibulum interdum. Nulla quis diam. Ut tempus purus at lorem.";g[5]="In sem justo, commodo ut, suscipit at, pharetra vitae, orci. Duis sapien nunc, commodo et, interdum suscipit, sollicitudin et, dolor. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Aliquam id dolor. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Mauris dictum facilisis augue. Fusce tellus. Pellentesque arcu. Maecenas fermentum, sem in pharetra pellentesque, velit turpis volutpat ante, in pharetra metus odio a lectus. Sed elit dui, pellentesque a, faucibus vel, interdum nec, diam. Mauris dolor felis, sagittis at, luctus sed, aliquam non, tellus. Etiam ligula pede, sagittis quis, interdum ultricies, scelerisque eu, urna. Nullam at arcu a est sollicitudin euismod. Praesent dapibus. Duis bibendum, lectus ut viverra rhoncus, dolor nunc faucibus libero, eget facilisis enim ipsum id lacus. Nam sed tellus id magna elementum tincidunt.";g[6]="Morbi a metus. Phasellus enim erat, vestibulum vel, aliquam a, posuere eu, velit. Nullam sapien sem, ornare ac, nonummy non, lobortis a, enim. Nunc tincidunt ante vitae massa. Duis ante orci, molestie vitae, vehicula venenatis, tincidunt ac, pede. Nulla accumsan, elit sit amet varius semper, nulla mauris mollis quam, tempor suscipit diam nulla vel leo. Etiam commodo dui eget wisi. Donec iaculis gravida nulla. Donec quis nibh at felis congue commodo. Etiam bibendum elit eget erat.";g[7]="Praesent in mauris eu tortor porttitor accumsan. Mauris suscipit, ligula sit amet pharetra semper, nibh ante cursus purus, vel sagittis velit mauris vel metus. Aenean fermentum risus id tortor. Integer imperdiet lectus quis justo. Integer tempor. Vivamus ac urna vel leo pretium faucibus. Mauris elementum mauris vitae tortor. In dapibus augue non sapien. Aliquam ante. Curabitur bibendum justo non orci.";g[8]="Morbi leo mi, nonummy eget, tristique non, rhoncus non, leo. Nullam faucibus mi quis velit. Integer in sapien. Fusce tellus odio, dapibus id, fermentum quis, suscipit id, erat. Fusce aliquam vestibulum ipsum. Aliquam erat volutpat. Pellentesque sapien. Cras elementum. Nulla pulvinar eleifend sem. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Quisque porta. Vivamus porttitor turpis ac leo.";g[9]="Maecenas ipsum velit, consectetuer eu, lobortis ut, dictum at, dui. In rutrum. Sed ac dolor sit amet purus malesuada congue. In laoreet, magna id viverra tincidunt, sem odio bibendum justo, vel imperdiet sapien wisi sed libero. Suspendisse sagittis ultrices augue. Mauris metus. Nunc dapibus tortor vel mi dapibus sollicitudin. Etiam posuere lacus quis dolor. Praesent id justo in neque elementum ultrices. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. In convallis. Fusce suscipit libero eget elit. Praesent vitae arcu tempor neque lacinia pretium. Morbi imperdiet, mauris ac auctor dictum, nisl ligula egestas nulla, et sollicitudin sem purus in lacus.";g[10]="Aenean placerat. In vulputate urna eu arcu. Aliquam erat volutpat. Suspendisse potenti. Morbi mattis felis at nunc. Duis viverra diam non justo. In nisl. Nullam sit amet magna in magna gravida vehicula. Mauris tincidunt sem sed arcu. Nunc posuere. Nullam lectus justo, vulputate eget, mollis sed, tempor sed, magna. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Etiam neque. Curabitur ligula sapien, pulvinar a, vestibulum quis, facilisis vel, sapien. Nullam eget nisl. Donec vitae arcu.";function f(){var p="";for(var o=0;o<j;o++){rnd_number=Math.floor(Math.random()*k+b);if(e.ptags==true){p+="<p>"}p+=g[rnd_number];if(h.ptags==true){p+="</p>"}p+="\n\n"}switch(h.type){case"words":var t=h.amount;t=parseInt(t);var q=new Array();var l=new Array();l=p.split(" ");var u=0;var r=0;while(q.length<t){if(r>l.length){r=0;u++;if(u+1>g.length){u=0}l=g[u].split(" ");l[0]="\n\n"+l[0]}q.push(l[r]);r++}p=q.join(" ");break;case"characters":var m="";var s=h.amount;s=parseInt(s);var n=g.join("\n\n");while(m.length<s){m+=n}p=m.substring(0,s);break;case"paragraphs":break}return p}return this.each(function(){$this=a(this);var l=f();$this.html(l)})}})(jQuery);jQuery.bt={version:"0.9.5-rc1"};(function($){jQuery.fn.bt=function(content,options){if(typeof content!="string"){var contentSelect=true;options=content;content=false}else{var contentSelect=false}if(jQuery.fn.hoverIntent&&jQuery.bt.defaults.trigger=="hover"){jQuery.bt.defaults.trigger="hoverIntent"}return this.each(function(index){var opts=jQuery.extend(false,jQuery.bt.defaults,jQuery.bt.options,options);opts.spikeLength=numb(opts.spikeLength);opts.spikeGirth=numb(opts.spikeGirth);opts.overlap=numb(opts.overlap);var ajaxTimeout=false;if(opts.killTitle){$(this).find("[title]").andSelf().each(function(){if(!$(this).attr("bt-xTitle")){$(this).attr("bt-xTitle",$(this).attr("title")).attr("title","")}})}if(typeof opts.trigger=="string"){opts.trigger=[opts.trigger]}if(opts.trigger[0]=="hoverIntent"){var hoverOpts=jQuery.extend(opts.hoverIntentOpts,{over:function(){this.btOn()},out:function(){this.btOff()}});$(this).hoverIntent(hoverOpts)}else{if(opts.trigger[0]=="hover"){$(this).hover(function(){this.btOn()},function(){this.btOff()})}else{if(opts.trigger[0]=="now"){if($(this).hasClass("bt-active")){this.btOff()}else{this.btOn()}}else{if(opts.trigger[0]=="none"){}else{if(opts.trigger.length>1&&opts.trigger[0]!=opts.trigger[1]){$(this).bind(opts.trigger[0],function(){this.btOn()}).bind(opts.trigger[1],function(){this.btOff()})}else{$(this).bind(opts.trigger[0],function(){if($(this).hasClass("bt-active")){this.btOff()}else{this.btOn()}})}}}}}this.btOn=function(){if(typeof $(this).data("bt-box")=="object"){this.btOff()}opts.preBuild.apply(this);$(jQuery.bt.vars.closeWhenOpenStack).btOff();$(this).addClass("bt-active "+opts.activeClass);if(contentSelect&&opts.ajaxPath==null){if(opts.killTitle){$(this).attr("title",$(this).attr("bt-xTitle"))}content=$.isFunction(opts.contentSelector)?opts.contentSelector.apply(this):eval(opts.contentSelector);if(opts.killTitle){$(this).attr("title","")}}if(opts.ajaxPath!=null&&content==false){if(typeof opts.ajaxPath=="object"){var url=eval(opts.ajaxPath[0]);url+=opts.ajaxPath[1]?" "+opts.ajaxPath[1]:""}else{var url=opts.ajaxPath}var off=url.indexOf(" ");if(off>=0){var selector=url.slice(off,url.length);url=url.slice(0,off)}var cacheData=opts.ajaxCache?$(document.body).data("btCache-"+url.replace(/\./g,"")):null;if(typeof cacheData=="string"){content=selector?$("<div/>").append(cacheData.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):cacheData}else{var target=this;var ajaxOpts=jQuery.extend(false,{type:opts.ajaxType,data:opts.ajaxData,cache:opts.ajaxCache,url:url,complete:function(XMLHttpRequest,textStatus){if(textStatus=="success"||textStatus=="notmodified"){if(opts.ajaxCache){$(document.body).data("btCache-"+url.replace(/\./g,""),XMLHttpRequest.responseText)}ajaxTimeout=false;content=selector?$("<div/>").append(XMLHttpRequest.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(selector):XMLHttpRequest.responseText}else{if(textStatus=="timeout"){ajaxTimeout=true}content=opts.ajaxError.replace(/%error/g,XMLHttpRequest.statusText)}if($(target).hasClass("bt-active")){target.btOn()}}},opts.ajaxOpts);jQuery.ajax(ajaxOpts);content=opts.ajaxLoading}}var shadowMarginX=0;var shadowMarginY=0;var shadowShiftX=0;var shadowShiftY=0;if(opts.shadow&&!shadowSupport()){opts.shadow=false;jQuery.extend(opts,opts.noShadowOpts)}if(opts.shadow){if(opts.shadowBlur>Math.abs(opts.shadowOffsetX)){shadowMarginX=opts.shadowBlur*2}else{shadowMarginX=opts.shadowBlur+Math.abs(opts.shadowOffsetX)}shadowShiftX=(opts.shadowBlur-opts.shadowOffsetX)>0?opts.shadowBlur-opts.shadowOffsetX:0;if(opts.shadowBlur>Math.abs(opts.shadowOffsetY)){shadowMarginY=opts.shadowBlur*2}else{shadowMarginY=opts.shadowBlur+Math.abs(opts.shadowOffsetY)}shadowShiftY=(opts.shadowBlur-opts.shadowOffsetY)>0?opts.shadowBlur-opts.shadowOffsetY:0}if(opts.offsetParent){var offsetParent=$(opts.offsetParent);var offsetParentPos=offsetParent.offset();var pos=$(this).offset();var top=numb(pos.top)-numb(offsetParentPos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)-numb(offsetParentPos.left)+numb($(this).css("margin-left"))-shadowShiftX}else{var offsetParent=($(this).css("position")=="absolute")?$(this).parents().eq(0).offsetParent():$(this).offsetParent();var pos=$(this).btPosition();var top=numb(pos.top)+numb($(this).css("margin-top"))-shadowShiftY;var left=numb(pos.left)+numb($(this).css("margin-left"))-shadowShiftX}var width=$(this).btOuterWidth();var height=$(this).outerHeight();if(typeof content=="object"){var original=content;var clone=$(original).clone(true).show();var origClones=$(original).data("bt-clones")||[];origClones.push(clone);$(original).data("bt-clones",origClones);$(clone).data("bt-orig",original);$(this).data("bt-content-orig",{original:original,clone:clone});content=clone}if(typeof content=="null"||content==""){return}var $text=$('<div class="bt-content"></div>').append(content).css({padding:opts.padding,position:"absolute",width:(opts.shrinkToFit?"auto":opts.width),zIndex:opts.textzIndex,left:shadowShiftX,top:shadowShiftY}).css(opts.cssStyles);var $box=$('<div class="bt-wrapper"></div>').append($text).addClass(opts.cssClass).css({position:"absolute",width:opts.width,zIndex:opts.wrapperzIndex,visibility:"hidden"}).appendTo(offsetParent);if(jQuery.fn.bgiframe){$text.bgiframe();$box.bgiframe()}$(this).data("bt-box",$box);var scrollTop=numb($(document).scrollTop());var scrollLeft=numb($(document).scrollLeft());var docWidth=numb($(window).width());var docHeight=numb($(window).height());var winRight=scrollLeft+docWidth;var winBottom=scrollTop+docHeight;var space=new Object();var thisOffset=$(this).offset();space.top=thisOffset.top-scrollTop;space.bottom=docHeight-((thisOffset+height)-scrollTop);space.left=thisOffset.left-scrollLeft;space.right=docWidth-((thisOffset.left+width)-scrollLeft);var textOutHeight=numb($text.outerHeight());var textOutWidth=numb($text.btOuterWidth());if(opts.positions.constructor==String){opts.positions=opts.positions.replace(/ /,"").split(",")}if(opts.positions[0]=="most"){var position="top";for(var pig in space){position=space[pig]>space[position]?pig:position}}else{for(var x in opts.positions){var position=opts.positions[x];if((position=="left"||position=="right")&&space[position]>textOutWidth+opts.spikeLength){break}else{if((position=="top"||position=="bottom")&&space[position]>textOutHeight+opts.spikeLength){break}}}}var horiz=left+((width-textOutWidth)*0.5);var vert=top+((height-textOutHeight)*0.5);var points=new Array();var textTop,textLeft,textRight,textBottom,textTopSpace,textBottomSpace,textLeftSpace,textRightSpace,crossPoint,textCenter,spikePoint;switch(position){case"top":$text.css("margin-bottom",opts.spikeLength+"px");$box.css({top:(top-$text.outerHeight(true))+opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",(numb($box.css("left"))+textRightSpace)+"px");xShift-=textRightSpace}textLeftSpace=($text.offset().left+numb($text.css("margin-left")))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",(numb($box.css("left"))-textLeftSpace)+"px");xShift+=textLeftSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={y:textBottom+opts.spikeLength,x:((textRight-textLeft)*0.5)+xShift,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textBottom);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.CornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textBottom,type:"join"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:crossPoint.x+(opts.spikeGirth/2),y:textBottom,type:"join"};points[points.length]=spikePoint;break;case"left":$text.css("margin-right",opts.spikeLength+"px");$box.css({top:vert+"px",left:((left-$text.btOuterWidth(true))+opts.overlap)+"px"});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",(numb($box.css("top"))+textBottomSpace)+"px");yShift-=textBottomSpace}textTopSpace=($text.offset().top+numb($text.css("margin-top")))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",(numb($box.css("top"))-textTopSpace)+"px");yShift+=textTopSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:textRight+opts.spikeLength,y:((textBottom-textTop)*0.5)+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textRight);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textRight,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break;case"bottom":$text.css("margin-top",opts.spikeLength+"px");$box.css({top:(top+height)-opts.overlap,left:horiz});textRightSpace=(winRight-opts.windowMargin)-($text.offset().left+$text.btOuterWidth(true));var xShift=shadowShiftX;if(textRightSpace<0){$box.css("left",(numb($box.css("left"))+textRightSpace)+"px");xShift-=textRightSpace}textLeftSpace=($text.offset().left+numb($text.css("margin-left")))-(scrollLeft+opts.windowMargin);if(textLeftSpace<0){$box.css("left",(numb($box.css("left"))-textLeftSpace)+"px");xShift+=textLeftSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:((textRight-textLeft)*0.5)+xShift,y:shadowShiftY,type:"spike"};crossPoint=findIntersectX(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textTop);crossPoint.x=crossPoint.x<textLeft+opts.spikeGirth/2+opts.cornerRadius?textLeft+opts.spikeGirth/2+opts.cornerRadius:crossPoint.x;crossPoint.x=crossPoint.x>(textRight-opts.spikeGirth/2)-opts.cornerRadius?(textRight-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.x;points[points.length]={x:crossPoint.x+opts.spikeGirth/2,y:textTop,type:"join"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:crossPoint.x-(opts.spikeGirth/2),y:textTop,type:"join"};points[points.length]=spikePoint;break;case"right":$text.css("margin-left",(opts.spikeLength+"px"));$box.css({top:vert+"px",left:((left+width)-opts.overlap)+"px"});textBottomSpace=(winBottom-opts.windowMargin)-($text.offset().top+$text.outerHeight(true));var yShift=shadowShiftY;if(textBottomSpace<0){$box.css("top",(numb($box.css("top"))+textBottomSpace)+"px");yShift-=textBottomSpace}textTopSpace=($text.offset().top+numb($text.css("margin-top")))-(scrollTop+opts.windowMargin);if(textTopSpace<0){$box.css("top",(numb($box.css("top"))-textTopSpace)+"px");yShift+=textTopSpace}textTop=$text.btPosition().top+numb($text.css("margin-top"));textLeft=$text.btPosition().left+numb($text.css("margin-left"));textRight=textLeft+$text.btOuterWidth();textBottom=textTop+$text.outerHeight();textCenter={x:textLeft+($text.btOuterWidth()*opts.centerPointX),y:textTop+($text.outerHeight()*opts.centerPointY)};points[points.length]=spikePoint={x:shadowShiftX,y:((textBottom-textTop)*0.5)+yShift,type:"spike"};crossPoint=findIntersectY(spikePoint.x,spikePoint.y,textCenter.x,textCenter.y,textLeft);crossPoint.y=crossPoint.y<textTop+opts.spikeGirth/2+opts.cornerRadius?textTop+opts.spikeGirth/2+opts.cornerRadius:crossPoint.y;crossPoint.y=crossPoint.y>(textBottom-opts.spikeGirth/2)-opts.cornerRadius?(textBottom-opts.spikeGirth/2)-opts.cornerRadius:crossPoint.y;points[points.length]={x:textLeft,y:crossPoint.y-opts.spikeGirth/2,type:"join"};points[points.length]={x:textLeft,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textTop,type:"corner"};points[points.length]={x:textRight,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:textBottom,type:"corner"};points[points.length]={x:textLeft,y:crossPoint.y+opts.spikeGirth/2,type:"join"};points[points.length]=spikePoint;break}var canvas=document.createElement("canvas");$(canvas).attr("width",(numb($text.btOuterWidth(true))+opts.strokeWidth*2+shadowMarginX)).attr("height",(numb($text.outerHeight(true))+opts.strokeWidth*2+shadowMarginY)).appendTo($box).css({position:"absolute",zIndex:opts.boxzIndex});if(typeof G_vmlCanvasManager!="undefined"){canvas=G_vmlCanvasManager.initElement(canvas)}if(opts.cornerRadius>0){var newPoints=new Array();var newPoint;for(var i=0;i<points.length;i++){if(points[i].type=="corner"){newPoint=betweenPoint(points[i],points[(i-1)%points.length],opts.cornerRadius);newPoint.type="arcStart";newPoints[newPoints.length]=newPoint;newPoints[newPoints.length]=points[i];newPoint=betweenPoint(points[i],points[(i+1)%points.length],opts.cornerRadius);newPoint.type="arcEnd";newPoints[newPoints.length]=newPoint}else{newPoints[newPoints.length]=points[i]}}points=newPoints}var ctx=canvas.getContext("2d");if(opts.shadow&&opts.shadowOverlap!==true){var shadowOverlap=numb(opts.shadowOverlap);switch(position){case"top":if(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap>0){$box.css("top",(numb($box.css("top"))-(opts.shadowOffsetX+opts.shadowBlur-shadowOverlap)))}break;case"right":if(shadowShiftX-shadowOverlap>0){$box.css("left",(numb($box.css("left"))+shadowShiftX-shadowOverlap))}break;case"bottom":if(shadowShiftY-shadowOverlap>0){$box.css("top",(numb($box.css("top"))+shadowShiftY-shadowOverlap))}break;case"left":if(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap>0){$box.css("left",(numb($box.css("left"))-(opts.shadowOffsetY+opts.shadowBlur-shadowOverlap)))}break}}drawIt.apply(ctx,[points],opts.strokeWidth);ctx.fillStyle=opts.fill;if(opts.shadow){ctx.shadowOffsetX=opts.shadowOffsetX;ctx.shadowOffsetY=opts.shadowOffsetY;ctx.shadowBlur=opts.shadowBlur;ctx.shadowColor=opts.shadowColor}ctx.closePath();ctx.fill();if(opts.strokeWidth>0){ctx.shadowColor="rgba(0, 0, 0, 0)";ctx.lineWidth=opts.strokeWidth;ctx.strokeStyle=opts.strokeStyle;ctx.beginPath();drawIt.apply(ctx,[points],opts.strokeWidth);ctx.closePath();ctx.stroke()}opts.preShow.apply(this,[$box[0]]);$box.css({display:"none",visibility:"visible"});opts.showTip.apply(this,[$box[0]]);if(opts.overlay){var overlay=$('<div class="bt-overlay"></div>').css({position:"absolute",backgroundColor:"blue",top:top,left:left,width:width,height:height,opacity:".2"}).appendTo(offsetParent);$(this).data("overlay",overlay)}if((opts.ajaxPath!=null&&opts.ajaxCache==false)||ajaxTimeout){content=false}if(opts.clickAnywhereToClose){jQuery.bt.vars.clickAnywhereStack.push(this);$(document).click(jQuery.bt.docClick)}if(opts.closeWhenOthersOpen){jQuery.bt.vars.closeWhenOpenStack.push(this)}opts.postShow.apply(this,[$box[0]])};this.btOff=function(){var box=$(this).data("bt-box");opts.preHide.apply(this,[box]);var i=this;i.btCleanup=function(){var box=$(i).data("bt-box");var contentOrig=$(i).data("bt-content-orig");var overlay=$(i).data("bt-overlay");if(typeof box=="object"){$(box).remove();$(i).removeData("bt-box")}if(typeof contentOrig=="object"){var clones=$(contentOrig.original).data("bt-clones");$(contentOrig).data("bt-clones",arrayRemove(clones,contentOrig.clone))}if(typeof overlay=="object"){$(overlay).remove();$(i).removeData("bt-overlay")}jQuery.bt.vars.clickAnywhereStack=arrayRemove(jQuery.bt.vars.clickAnywhereStack,i);jQuery.bt.vars.closeWhenOpenStack=arrayRemove(jQuery.bt.vars.closeWhenOpenStack,i);$(i).removeClass("bt-active "+opts.activeClass);opts.postHide.apply(i)};opts.hideTip.apply(this,[box,i.btCleanup])};var refresh=this.btRefresh=function(){this.btOff();this.btOn()}});function drawIt(points,strokeWidth){this.moveTo(points[0].x,points[0].y);for(i=1;i<points.length;i++){if(points[i-1].type=="arcStart"){this.quadraticCurveTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth),round5(points[(i+1)%points.length].x,strokeWidth),round5(points[(i+1)%points.length].y,strokeWidth));i++}else{this.lineTo(round5(points[i].x,strokeWidth),round5(points[i].y,strokeWidth))}}}function round5(num,strokeWidth){var ret;strokeWidth=numb(strokeWidth);if(strokeWidth%2){ret=num}else{ret=Math.round(num-0.5)+0.5}return ret}function numb(num){return parseInt(num)||0}function arrayRemove(arr,elem){var x,newArr=new Array();for(x in arr){if(arr[x]!=elem){newArr.push(arr[x])}}return newArr}function canvasSupport(){var canvas_compatible=false;try{canvas_compatible=!!(document.createElement("canvas").getContext("2d"))}catch(e){canvas_compatible=!!(document.createElement("canvas").getContext)}return canvas_compatible}function shadowSupport(){try{var userAgent=navigator.userAgent.toLowerCase();if(/webkit/.test(userAgent)){return true}else{if(/gecko|mozilla/.test(userAgent)&&parseFloat(userAgent.match(/firefox\/(\d+(?:\.\d+)+)/)[1])>=3.1){return true}}}catch(err){}return false}function betweenPoint(point1,point2,dist){var y,x;if(point1.x==point2.x){y=point1.y<point2.y?point1.y+dist:point1.y-dist;return{x:point1.x,y:y}}else{if(point1.y==point2.y){x=point1.x<point2.x?point1.x+dist:point1.x-dist;return{x:x,y:point1.y}}}}function centerPoint(arcStart,corner,arcEnd){var x=corner.x==arcStart.x?arcEnd.x:arcStart.x;var y=corner.y==arcStart.y?arcEnd.y:arcStart.y;var startAngle,endAngle;if(arcStart.x<arcEnd.x){if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*180;endAngle=(Math.PI/180)*90}else{startAngle=(Math.PI/180)*90;endAngle=0}}else{if(arcStart.y>arcEnd.y){startAngle=(Math.PI/180)*270;endAngle=(Math.PI/180)*180}else{startAngle=0;endAngle=(Math.PI/180)*270}}return{x:x,y:y,type:"center",startAngle:startAngle,endAngle:endAngle}}function findIntersect(r1x1,r1y1,r1x2,r1y2,r2x1,r2y1,r2x2,r2y2){if(r2x1==r2x2){return findIntersectY(r1x1,r1y1,r1x2,r1y2,r2x1)}if(r2y1==r2y2){return findIntersectX(r1x1,r1y1,r1x2,r1y2,r2y1)}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var r2m=(r2y1-r2y2)/(r2x1-r2x2);var r2b=r2y1-(r2m*r2x1);var x=(r2b-r1b)/(r1m-r2m);var y=r1m*x+r1b;return{x:x,y:y}}function findIntersectY(r1x1,r1y1,r1x2,r1y2,x){if(r1y1==r1y2){return{x:x,y:r1y1}}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var y=r1m*x+r1b;return{x:x,y:y}}function findIntersectX(r1x1,r1y1,r1x2,r1y2,y){if(r1x1==r1x2){return{x:r1x1,y:y}}var r1m=(r1y1-r1y2)/(r1x1-r1x2);var r1b=r1y1-(r1m*r1x1);var x=(y-r1b)/r1m;return{x:x,y:y}}};jQuery.fn.btPosition=function(){function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0}var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,"marginTop");offset.left-=num(this,"marginLeft");parentOffset.top+=num(offsetParent,"borderTopWidth");parentOffset.left+=num(offsetParent,"borderLeftWidth");results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}}return results};jQuery.fn.btOuterWidth=function(margin){function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0}return this["innerWidth"]()+num(this,"borderLeftWidth")+num(this,"borderRightWidth")+(margin?num(this,"marginLeft")+num(this,"marginRight"):0)};jQuery.fn.btOn=function(){return this.each(function(index){if(jQuery.isFunction(this.btOn)){this.btOn()}})};jQuery.fn.btOff=function(){return this.each(function(index){if(jQuery.isFunction(this.btOff)){this.btOff()}})};jQuery.bt.vars={clickAnywhereStack:[],closeWhenOpenStack:[]};jQuery.bt.docClick=function(e){if(!e){var e=window.event}if(!$(e.target).parents().andSelf().filter(".bt-wrapper, .bt-active").length&&jQuery.bt.vars.clickAnywhereStack.length){$(jQuery.bt.vars.clickAnywhereStack).btOff();$(document).unbind("click",jQuery.bt.docClick)}};jQuery.bt.defaults={trigger:"hover",clickAnywhereToClose:true,closeWhenOthersOpen:false,shrinkToFit:false,width:"200px",padding:"10px",spikeGirth:10,spikeLength:15,overlap:0,overlay:false,killTitle:true,textzIndex:9999,boxzIndex:9998,wrapperzIndex:9997,offsetParent:null,positions:["most"],fill:"rgb(255, 255, 102)",windowMargin:10,strokeWidth:1,strokeStyle:"#000",cornerRadius:5,centerPointX:0.5,centerPointY:0.5,shadow:false,shadowOffsetX:2,shadowOffsetY:2,shadowBlur:3,shadowColor:"#000",shadowOverlap:false,noShadowOpts:{strokeStyle:"#999"},cssClass:"",cssStyles:{},activeClass:"bt-active",contentSelector:"$(this).attr('title')",ajaxPath:null,ajaxError:"<strong>ERROR:</strong> <em>%error</em>",ajaxLoading:"<blink>Loading...</blink>",ajaxData:{},ajaxType:"GET",ajaxCache:true,ajaxOpts:{},preBuild:function(){},preShow:function(box){},showTip:function(box){$(box).show()},postShow:function(box){},preHide:function(box){},hideTip:function(box,callback){$(box).hide();callback()},postHide:function(){},hoverIntentOpts:{interval:300,timeout:500}};jQuery.bt.options={}})(jQuery);jQuery.ui||(function(p){var j=p.fn.remove,o=p.browser.mozilla&&(parseFloat(p.browser.version)<1.9);p.ui={version:"1.7.2",plugin:{add:function(c,b,f){var a=p.ui[c].prototype;for(var e in f){a.plugins[e]=a.plugins[e]||[];a.plugins[e].push([b,f[e]])}},call:function(e,b,c){var f=e.plugins[b];if(!f||!e.element[0].parentNode){return}for(var a=0;a<f.length;a++){if(e.options[f[a][0]]){f[a][1].apply(e.element,c)}}}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(a,c){if(p(a).css("overflow")=="hidden"){return false}var e=(c&&c=="left")?"scrollLeft":"scrollTop",b=false;if(a[e]>0){return true}a[e]=1;b=(a[e]>0);a[e]=0;return b},isOverAxis:function(b,c,a){return(b>c)&&(b<(c+a))},isOver:function(f,c,g,a,e,b){return p.ui.isOverAxis(f,g,e)&&p.ui.isOverAxis(c,a,b)},keyCode:{BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38}};if(o){var m=p.attr,n=p.fn.removeAttr,k="http://www.w3.org/2005/07/aaa",r=/^aria-/,q=/^wairole:/;p.attr=function(c,e,b){var a=b!==undefined;return(e=="role"?(a?m.call(this,c,e,"wairole:"+b):(m.apply(this,arguments)||"").replace(q,"")):(r.test(e)?(a?c.setAttributeNS(k,e.replace(r,"aaa:"),b):m.call(this,c,e.replace(r,"aaa:"))):m.apply(this,arguments)))};p.fn.removeAttr=function(a){return(r.test(a)?this.each(function(){this.removeAttributeNS(k,a.replace(r,""))}):n.call(this,a))}}p.fn.extend({remove:function(){p("*",this).add(this).each(function(){p(this).triggerHandler("remove")});return j.apply(this,arguments)},enableSelection:function(){return this.attr("unselectable","off").css("MozUserSelect","").unbind("selectstart.ui")},disableSelection:function(){return this.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})},scrollParent:function(){var a;if((p.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){a=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(p.curCSS(this,"position",1))&&(/(auto|scroll)/).test(p.curCSS(this,"overflow",1)+p.curCSS(this,"overflow-y",1)+p.curCSS(this,"overflow-x",1))}).eq(0)}else{a=this.parents().filter(function(){return(/(auto|scroll)/).test(p.curCSS(this,"overflow",1)+p.curCSS(this,"overflow-y",1)+p.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!a.length?p(document):a}});p.extend(p.expr[":"],{data:function(a,b,c){return !!p.data(a,c[3])},focusable:function(b){var a=b.nodeName.toLowerCase(),c=p.attr(b,"tabindex");return(/input|select|textarea|button|object/.test(a)?!b.disabled:"a"==a||"area"==a?b.href||!isNaN(c):!isNaN(c))&&!p(b)["area"==a?"parents":"closest"](":hidden").length},tabbable:function(a){var b=p.attr(a,"tabindex");return(isNaN(b)||b>=0)&&p(a).is(":focusable")}});function l(a,g,f,b){function c(h){var s=p[a][g][h]||[];return(typeof s=="string"?s.split(/,?\s+/):s)}var e=c("getter");if(b.length==1&&typeof b[0]=="string"){e=e.concat(c("getterSetter"))}return(p.inArray(f,e)!=-1)}p.widget=function(b,c){var a=b.split(".")[0];b=b.split(".")[1];p.fn[b]=function(f){var h=(typeof f=="string"),g=Array.prototype.slice.call(arguments,1);if(h&&f.substring(0,1)=="_"){return this}if(h&&l(a,b,f,g)){var e=p.data(this[0],b);return(e?e[f].apply(e,g):undefined)}return this.each(function(){var s=p.data(this,b);(!s&&!h&&p.data(this,b,new p[a][b](this,f))._init());(s&&h&&p.isFunction(s[f])&&s[f].apply(s,g))})};p[a]=p[a]||{};p[a][b]=function(f,g){var e=this;this.namespace=a;this.widgetName=b;this.widgetEventPrefix=p[a][b].eventPrefix||b;this.widgetBaseClass=a+"-"+b;this.options=p.extend({},p.widget.defaults,p[a][b].defaults,p.metadata&&p.metadata.get(f)[b],g);this.element=p(f).bind("setData."+b,function(s,t,h){if(s.target==f){return e._setData(t,h)}}).bind("getData."+b,function(h,s){if(h.target==f){return e._getData(s)}}).bind("remove",function(){return e.destroy()})};p[a][b].prototype=p.extend({},p.widget.prototype,c);p[a][b].getterSetter="option"};p.widget.prototype={_init:function(){},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled")},option:function(b,a){var c=b,e=this;if(typeof b=="string"){if(a===undefined){return this._getData(b)}c={};c[b]=a}p.each(c,function(g,f){e._setData(g,f)})},_getData:function(a){return this.options[a]},_setData:function(b,a){this.options[b]=a;if(b=="disabled"){this.element[a?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",a)}},enable:function(){this._setData("disabled",false)},disable:function(){this._setData("disabled",true)},_trigger:function(b,a,h){var f=this.options[b],e=(b==this.widgetEventPrefix?b:this.widgetEventPrefix+b);a=p.Event(a);a.type=e;if(a.originalEvent){for(var c=p.event.props.length,g;c;){g=p.event.props[--c];a[g]=a.originalEvent[g]}}this.element.trigger(a,h);return !(p.isFunction(f)&&f.call(this.element[0],a,h)===false||a.isDefaultPrevented())}};p.widget.defaults={disabled:false};p.ui.mouse={_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(b){return a._mouseDown(b)}).bind("click."+this.widgetName,function(b){if(a._preventClickEvent){a._preventClickEvent=false;b.stopImmediatePropagation();return false}});if(p.browser.msie){this._mouseUnselectable=this.element.attr("unselectable");this.element.attr("unselectable","on")}this.started=false},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);(p.browser.msie&&this.element.attr("unselectable",this._mouseUnselectable))},_mouseDown:function(b){b.originalEvent=b.originalEvent||{};if(b.originalEvent.mouseHandled){return}(this._mouseStarted&&this._mouseUp(b));this._mouseDownEvent=b;var c=this,a=(b.which==1),e=(typeof this.options.cancel=="string"?p(b.target).parents().add(b.target).filter(this.options.cancel).length:false);if(!a||e||!this._mouseCapture(b)){return true}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true},this.options.delay)}if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=(this._mouseStart(b)!==false);if(!this._mouseStarted){b.preventDefault();return true}}this._mouseMoveDelegate=function(f){return c._mouseMove(f)};this._mouseUpDelegate=function(f){return c._mouseUp(f)};p(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);(p.browser.safari||b.preventDefault());b.originalEvent.mouseHandled=true;return true},_mouseMove:function(a){if(p.browser.msie&&!a.button){return this._mouseUp(a)}if(this._mouseStarted){this._mouseDrag(a);return a.preventDefault()}if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,a)!==false);(this._mouseStarted?this._mouseDrag(a):this._mouseUp(a))}return !this._mouseStarted},_mouseUp:function(a){p(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=(a.target==this._mouseDownEvent.target);this._mouseStop(a)}return false},_mouseDistanceMet:function(a){return(Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance)},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return true}};p.ui.mouse.defaults={cancel:null,distance:1,delay:0}})(jQuery);(function(b){b.widget("ui.draggable",b.extend({},b.ui.mouse,{_init:function(){if(this.options.helper=="original"&&!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative"}(this.options.addClasses&&this.element.addClass("ui-draggable"));(this.options.disabled&&this.element.addClass("ui-draggable-disabled"));this._mouseInit()},destroy:function(){if(!this.element.data("draggable")){return}this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy()},_mouseCapture:function(a){var e=this.options;if(this.helper||e.disabled||b(a.target).is(".ui-resizable-handle")){return false}this.handle=this._getHandle(a);if(!this.handle){return false}return true},_mouseStart:function(a){var e=this.options;this.helper=this._createHelper(a);this._cacheHelperProportions();if(b.ui.ddmanager){b.ui.ddmanager.current=this}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};b.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this._generatePosition(a);this.originalPageX=a.pageX;this.originalPageY=a.pageY;if(e.cursorAt){this._adjustOffsetFromHelper(e.cursorAt)}if(e.containment){this._setContainment()}this._trigger("start",a);this._cacheHelperProportions();if(b.ui.ddmanager&&!e.dropBehaviour){b.ui.ddmanager.prepareOffsets(this,a)}this.helper.addClass("ui-draggable-dragging");this._mouseDrag(a,true);return true},_mouseDrag:function(a,e){this.position=this._generatePosition(a);this.positionAbs=this._convertPositionTo("absolute");if(!e){var f=this._uiHash();this._trigger("drag",a,f);this.position=f.position}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}if(b.ui.ddmanager){b.ui.ddmanager.drag(this,a)}return false},_mouseStop:function(f){var e=false;if(b.ui.ddmanager&&!this.options.dropBehaviour){e=b.ui.ddmanager.drop(this,f)}if(this.dropped){e=this.dropped;this.dropped=false}if((this.options.revert=="invalid"&&!e)||(this.options.revert=="valid"&&e)||this.options.revert===true||(b.isFunction(this.options.revert)&&this.options.revert.call(this.element,e))){var a=this;b(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){a._trigger("stop",f);a._clear()})}else{this._trigger("stop",f);this._clear()}return false},_getHandle:function(a){var e=!this.options.handle||!b(this.options.handle,this.element).length?true:false;b(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==a.target){e=true}});return e},_createHelper:function(f){var e=this.options;var a=b.isFunction(e.helper)?b(e.helper.apply(this.element[0],[f])):(e.helper=="clone"?this.element.clone():this.element);if(!a.parents("body").length){a.appendTo((e.appendTo=="parent"?this.element[0].parentNode:e.appendTo))}if(a[0]!=this.element[0]&&!(/(fixed|absolute)/).test(a.css("position"))){a.css("position","absolute")}return a},_adjustOffsetFromHelper:function(a){if(a.left!=undefined){this.offset.click.left=a.left+this.margins.left}if(a.right!=undefined){this.offset.click.left=this.helperProportions.width-a.right+this.margins.left}if(a.top!=undefined){this.offset.click.top=a.top+this.margins.top}if(a.bottom!=undefined){this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&b.ui.contains(this.scrollParent[0],this.offsetParent[0])){a.left+=this.scrollParent.scrollLeft();a.top+=this.scrollParent.scrollTop()}if((this.offsetParent[0]==document.body)||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&b.browser.msie)){a={top:0,left:0}}return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var f=this.options;if(f.containment=="parent"){f.containment=this.helper[0].parentNode}if(f.containment=="document"||f.containment=="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,b(f.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(b(f.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(f.containment)&&f.containment.constructor!=Array){var h=b(f.containment)[0];if(!h){return}var g=b(f.containment).offset();var a=(b(h).css("overflow")!="hidden");this.containment=[g.left+(parseInt(b(h).css("borderLeftWidth"),10)||0)+(parseInt(b(h).css("paddingLeft"),10)||0)-this.margins.left,g.top+(parseInt(b(h).css("borderTopWidth"),10)||0)+(parseInt(b(h).css("paddingTop"),10)||0)-this.margins.top,g.left+(a?Math.max(h.scrollWidth,h.offsetWidth):h.offsetWidth)-(parseInt(b(h).css("borderLeftWidth"),10)||0)-(parseInt(b(h).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,g.top+(a?Math.max(h.scrollHeight,h.offsetHeight):h.offsetHeight)-(parseInt(b(h).css("borderTopWidth"),10)||0)-(parseInt(b(h).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}else{if(f.containment.constructor==Array){this.containment=f.containment}}},_convertPositionTo:function(l,j){if(!j){j=this.position}var n=l=="absolute"?1:-1;var m=this.options,a=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&b.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,k=(/(html|body)/i).test(a[0].tagName);return{top:(j.top+this.offset.relative.top*n+this.offset.parent.top*n-(b.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(k?0:a.scrollTop()))*n)),left:(j.left+this.offset.relative.left*n+this.offset.parent.left*n-(b.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():k?0:a.scrollLeft())*n))}},_generatePosition:function(n){var k=this.options,a=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&b.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,j=(/(html|body)/i).test(a[0].tagName);if(this.cssPosition=="relative"&&!(this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}var o=n.pageX;var p=n.pageY;if(this.originalPosition){if(this.containment){if(n.pageX-this.offset.click.left<this.containment[0]){o=this.containment[0]+this.offset.click.left}if(n.pageY-this.offset.click.top<this.containment[1]){p=this.containment[1]+this.offset.click.top}if(n.pageX-this.offset.click.left>this.containment[2]){o=this.containment[2]+this.offset.click.left}if(n.pageY-this.offset.click.top>this.containment[3]){p=this.containment[3]+this.offset.click.top}}if(k.grid){var l=this.originalPageY+Math.round((p-this.originalPageY)/k.grid[1])*k.grid[1];p=this.containment?(!(l-this.offset.click.top<this.containment[1]||l-this.offset.click.top>this.containment[3])?l:(!(l-this.offset.click.top<this.containment[1])?l-k.grid[1]:l+k.grid[1])):l;var m=this.originalPageX+Math.round((o-this.originalPageX)/k.grid[0])*k.grid[0];o=this.containment?(!(m-this.offset.click.left<this.containment[0]||m-this.offset.click.left>this.containment[2])?m:(!(m-this.offset.click.left<this.containment[0])?m-k.grid[0]:m+k.grid[0])):m}}return{top:(p-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(b.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():(j?0:a.scrollTop())))),left:(o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(b.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():j?0:a.scrollLeft())))}},_clear:function(){this.helper.removeClass("ui-draggable-dragging");if(this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval){this.helper.remove()}this.helper=null;this.cancelHelperRemoval=false},_trigger:function(a,f,e){e=e||this._uiHash();b.ui.plugin.call(this,a,[f,e]);if(a=="drag"){this.positionAbs=this._convertPositionTo("absolute")}return b.widget.prototype._trigger.call(this,a,f,e)},plugins:{},_uiHash:function(a){return{helper:this.helper,position:this.position,absolutePosition:this.positionAbs,offset:this.positionAbs}}}));b.extend(b.ui.draggable,{version:"1.7.2",eventPrefix:"drag",defaults:{addClasses:true,appendTo:"parent",axis:false,cancel:":input,option",connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,delay:0,distance:1,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false}});b.ui.plugin.add("draggable","connectToSortable",{start:function(k,h){var j=b(this).data("draggable"),g=j.options,a=b.extend({},h,{item:j.element});j.sortables=[];b(g.connectToSortable).each(function(){var c=b.data(this,"sortable");if(c&&!c.options.disabled){j.sortables.push({instance:c,shouldRevert:c.options.revert});c._refreshItems();c._trigger("activate",k,a)}})},stop:function(h,f){var g=b(this).data("draggable"),a=b.extend({},f,{item:g.element});b.each(g.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;g.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=true}this.instance._mouseStop(h);this.instance.options.helper=this.instance.options._helper;if(g.options.helper=="original"){this.instance.currentItem.css({top:"auto",left:"auto"})}}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",h,a)}})},drag:function(k,g){var h=b(this).data("draggable"),a=this;var j=function(s){var e=this.offset.click.top,f=this.offset.click.left;var u=this.positionAbs.top,q=this.positionAbs.left;var r=s.height,o=s.width;var c=s.top,t=s.left;return b.ui.isOver(u+e,q+f,c,t,r,o)};b.each(h.sortables,function(c){this.instance.positionAbs=h.positionAbs;this.instance.helperProportions=h.helperProportions;this.instance.offset.click=h.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=b(a).clone().appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return g.helper[0]};k.target=this.instance.currentItem[0];this.instance._mouseCapture(k,true);this.instance._mouseStart(k,true,true);this.instance.offset.click.top=h.offset.click.top;this.instance.offset.click.left=h.offset.click.left;this.instance.offset.parent.left-=h.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=h.offset.parent.top-this.instance.offset.parent.top;h._trigger("toSortable",k);h.dropped=this.instance.element;h.currentItem=h.element;this.instance.fromOutside=h}if(this.instance.currentItem){this.instance._mouseDrag(k)}}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",k,this.instance._uiHash(this.instance));this.instance._mouseStop(k,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();if(this.instance.placeholder){this.instance.placeholder.remove()}h._trigger("fromSortable",k);h.dropped=false}}})}});b.ui.plugin.add("draggable","cursor",{start:function(h,g){var a=b("body"),f=b(this).data("draggable").options;if(a.css("cursor")){f._cursor=a.css("cursor")}a.css("cursor",f.cursor)},stop:function(a,f){var e=b(this).data("draggable").options;if(e._cursor){b("body").css("cursor",e._cursor)}}});b.ui.plugin.add("draggable","iframeFix",{start:function(a,f){var e=b(this).data("draggable").options;b(e.iframeFix===true?"iframe":e.iframeFix).each(function(){b('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css(b(this).offset()).appendTo("body")})},stop:function(a,e){b("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)})}});b.ui.plugin.add("draggable","opacity",{start:function(h,g){var a=b(g.helper),f=b(this).data("draggable").options;if(a.css("opacity")){f._opacity=a.css("opacity")}a.css("opacity",f.opacity)},stop:function(a,f){var e=b(this).data("draggable").options;if(e._opacity){b(f.helper).css("opacity",e._opacity)}}});b.ui.plugin.add("draggable","scroll",{start:function(f,e){var a=b(this).data("draggable");if(a.scrollParent[0]!=document&&a.scrollParent[0].tagName!="HTML"){a.overflowOffset=a.scrollParent.offset()}},drag:function(j,h){var k=b(this).data("draggable"),g=k.options,a=false;if(k.scrollParent[0]!=document&&k.scrollParent[0].tagName!="HTML"){if(!g.axis||g.axis!="x"){if((k.overflowOffset.top+k.scrollParent[0].offsetHeight)-j.pageY<g.scrollSensitivity){k.scrollParent[0].scrollTop=a=k.scrollParent[0].scrollTop+g.scrollSpeed}else{if(j.pageY-k.overflowOffset.top<g.scrollSensitivity){k.scrollParent[0].scrollTop=a=k.scrollParent[0].scrollTop-g.scrollSpeed}}}if(!g.axis||g.axis!="y"){if((k.overflowOffset.left+k.scrollParent[0].offsetWidth)-j.pageX<g.scrollSensitivity){k.scrollParent[0].scrollLeft=a=k.scrollParent[0].scrollLeft+g.scrollSpeed}else{if(j.pageX-k.overflowOffset.left<g.scrollSensitivity){k.scrollParent[0].scrollLeft=a=k.scrollParent[0].scrollLeft-g.scrollSpeed}}}}else{if(!g.axis||g.axis!="x"){if(j.pageY-b(document).scrollTop()<g.scrollSensitivity){a=b(document).scrollTop(b(document).scrollTop()-g.scrollSpeed)}else{if(b(window).height()-(j.pageY-b(document).scrollTop())<g.scrollSensitivity){a=b(document).scrollTop(b(document).scrollTop()+g.scrollSpeed)}}}if(!g.axis||g.axis!="y"){if(j.pageX-b(document).scrollLeft()<g.scrollSensitivity){a=b(document).scrollLeft(b(document).scrollLeft()-g.scrollSpeed)}else{if(b(window).width()-(j.pageX-b(document).scrollLeft())<g.scrollSensitivity){a=b(document).scrollLeft(b(document).scrollLeft()+g.scrollSpeed)}}}}if(a!==false&&b.ui.ddmanager&&!g.dropBehaviour){b.ui.ddmanager.prepareOffsets(k,j)}}});b.ui.plugin.add("draggable","snap",{start:function(h,g){var a=b(this).data("draggable"),f=a.options;a.snapElements=[];b(f.snap.constructor!=String?(f.snap.items||":data(draggable)"):f.snap).each(function(){var c=b(this);var e=c.offset();if(this!=a.element[0]){a.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:e.top,left:e.left})}})},drag:function(B,F){var L=b(this).data("draggable"),D=L.options;var l=D.snapTolerance;var o=F.offset.left,r=o+L.helperProportions.width,M=F.offset.top,N=M+L.helperProportions.height;for(var t=L.snapElements.length-1;t>=0;t--){var C=L.snapElements[t].left,G=C+L.snapElements[t].width,H=L.snapElements[t].top,E=H+L.snapElements[t].height;if(!((C-l<o&&o<G+l&&H-l<M&&M<E+l)||(C-l<o&&o<G+l&&H-l<N&&N<E+l)||(C-l<r&&r<G+l&&H-l<M&&M<E+l)||(C-l<r&&r<G+l&&H-l<N&&N<E+l))){if(L.snapElements[t].snapping){(L.options.snap.release&&L.options.snap.release.call(L.element,B,b.extend(L._uiHash(),{snapItem:L.snapElements[t].item})))}L.snapElements[t].snapping=false;continue}if(D.snapMode!="inner"){var O=Math.abs(H-N)<=l;var a=Math.abs(E-M)<=l;var J=Math.abs(C-r)<=l;var I=Math.abs(G-o)<=l;if(O){F.position.top=L._convertPositionTo("relative",{top:H-L.helperProportions.height,left:0}).top-L.margins.top}if(a){F.position.top=L._convertPositionTo("relative",{top:E,left:0}).top-L.margins.top}if(J){F.position.left=L._convertPositionTo("relative",{top:0,left:C-L.helperProportions.width}).left-L.margins.left}if(I){F.position.left=L._convertPositionTo("relative",{top:0,left:G}).left-L.margins.left}}var K=(O||a||J||I);if(D.snapMode!="outer"){var O=Math.abs(H-M)<=l;var a=Math.abs(E-N)<=l;var J=Math.abs(C-o)<=l;var I=Math.abs(G-r)<=l;if(O){F.position.top=L._convertPositionTo("relative",{top:H,left:0}).top-L.margins.top}if(a){F.position.top=L._convertPositionTo("relative",{top:E-L.helperProportions.height,left:0}).top-L.margins.top}if(J){F.position.left=L._convertPositionTo("relative",{top:0,left:C}).left-L.margins.left}if(I){F.position.left=L._convertPositionTo("relative",{top:0,left:G-L.helperProportions.width}).left-L.margins.left}}if(!L.snapElements[t].snapping&&(O||a||J||I||K)){(L.options.snap.snap&&L.options.snap.snap.call(L.element,B,b.extend(L._uiHash(),{snapItem:L.snapElements[t].item})))}L.snapElements[t].snapping=(O||a||J||I||K)}}});b.ui.plugin.add("draggable","stack",{start:function(a,h){var f=b(this).data("draggable").options;var g=b.makeArray(b(f.stack.group)).sort(function(c,e){return(parseInt(b(c).css("zIndex"),10)||f.stack.min)-(parseInt(b(e).css("zIndex"),10)||f.stack.min)});b(g).each(function(c){this.style.zIndex=f.stack.min+c});this[0].style.zIndex=f.stack.min+g.length}});b.ui.plugin.add("draggable","zIndex",{start:function(h,g){var a=b(g.helper),f=b(this).data("draggable").options;if(a.css("zIndex")){f._zIndex=a.css("zIndex")}a.css("zIndex",f.zIndex)},stop:function(a,f){var e=b(this).data("draggable").options;if(e._zIndex){b(f.helper).css("zIndex",e._zIndex)}}})})(jQuery);(function(b){b.widget("ui.droppable",{_init:function(){var e=this.options,a=e.accept;this.isover=0;this.isout=1;this.options.accept=this.options.accept&&b.isFunction(this.options.accept)?this.options.accept:function(c){return c.is(a)};this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};b.ui.ddmanager.droppables[this.options.scope]=b.ui.ddmanager.droppables[this.options.scope]||[];b.ui.ddmanager.droppables[this.options.scope].push(this);(this.options.addClasses&&this.element.addClass("ui-droppable"))},destroy:function(){var a=b.ui.ddmanager.droppables[this.options.scope];for(var e=0;e<a.length;e++){if(a[e]==this){a.splice(e,1)}}this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable")},_setData:function(a,e){if(a=="accept"){this.options.accept=e&&b.isFunction(e)?e:function(c){return c.is(e)}}else{b.widget.prototype._setData.apply(this,arguments)}},_activate:function(e){var a=b.ui.ddmanager.current;if(this.options.activeClass){this.element.addClass(this.options.activeClass)}(a&&this._trigger("activate",e,this.ui(a)))},_deactivate:function(e){var a=b.ui.ddmanager.current;if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}(a&&this._trigger("deactivate",e,this.ui(a)))},_over:function(e){var a=b.ui.ddmanager.current;if(!a||(a.currentItem||a.element)[0]==this.element[0]){return}if(this.options.accept.call(this.element[0],(a.currentItem||a.element))){if(this.options.hoverClass){this.element.addClass(this.options.hoverClass)}this._trigger("over",e,this.ui(a))}},_out:function(e){var a=b.ui.ddmanager.current;if(!a||(a.currentItem||a.element)[0]==this.element[0]){return}if(this.options.accept.call(this.element[0],(a.currentItem||a.element))){if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("out",e,this.ui(a))}},_drop:function(h,g){var a=g||b.ui.ddmanager.current;if(!a||(a.currentItem||a.element)[0]==this.element[0]){return false}var f=false;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var c=b.data(this,"droppable");if(c.options.greedy&&b.ui.intersect(a,b.extend(c,{offset:c.element.offset()}),c.options.tolerance)){f=true;return false}});if(f){return false}if(this.options.accept.call(this.element[0],(a.currentItem||a.element))){if(this.options.activeClass){this.element.removeClass(this.options.activeClass)}if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass)}this._trigger("drop",h,this.ui(a));return this.element}return false},ui:function(a){return{draggable:(a.currentItem||a.element),helper:a.helper,position:a.position,absolutePosition:a.positionAbs,offset:a.positionAbs}}});b.extend(b.ui.droppable,{version:"1.7.2",eventPrefix:"drop",defaults:{accept:"*",activeClass:false,addClasses:true,greedy:false,hoverClass:false,scope:"default",tolerance:"intersect"}});b.ui.intersect=function(a,v,r){if(!v.offset){return false}var A=(a.positionAbs||a.position.absolute).left,B=A+a.helperProportions.width,s=(a.positionAbs||a.position.absolute).top,t=s+a.helperProportions.height;var y=v.offset.left,C=y+v.proportions.width,l=v.offset.top,u=l+v.proportions.height;switch(r){case"fit":return(y<A&&B<C&&l<s&&t<u);break;case"intersect":return(y<A+(a.helperProportions.width/2)&&B-(a.helperProportions.width/2)<C&&l<s+(a.helperProportions.height/2)&&t-(a.helperProportions.height/2)<u);break;case"pointer":var x=((a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left),w=((a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top),z=b.ui.isOver(w,x,l,y,v.proportions.height,v.proportions.width);return z;break;case"touch":return((s>=l&&s<=u)||(t>=l&&t<=u)||(s<l&&t>u))&&((A>=y&&A<=C)||(B>=y&&B<=C)||(A<y&&B>C));break;default:return false;break}};b.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(m,k){var a=b.ui.ddmanager.droppables[m.options.scope];var l=k?k.type:null;var j=(m.currentItem||m.element).find(":data(droppable)").andSelf();droppablesLoop:for(var n=0;n<a.length;n++){if(a[n].options.disabled||(m&&!a[n].options.accept.call(a[n].element[0],(m.currentItem||m.element)))){continue}for(var o=0;o<j.length;o++){if(j[o]==a[n].element[0]){a[n].proportions.height=0;continue droppablesLoop}}a[n].visible=a[n].element.css("display")!="none";if(!a[n].visible){continue}a[n].offset=a[n].element.offset();a[n].proportions={width:a[n].element[0].offsetWidth,height:a[n].element[0].offsetHeight};if(l=="mousedown"){a[n]._activate.call(a[n],k)}}},drop:function(a,f){var e=false;b.each(b.ui.ddmanager.droppables[a.options.scope],function(){if(!this.options){return}if(!this.options.disabled&&this.visible&&b.ui.intersect(a,this,this.options.tolerance)){e=this._drop.call(this,f)}if(!this.options.disabled&&this.visible&&this.options.accept.call(this.element[0],(a.currentItem||a.element))){this.isout=1;this.isover=0;this._deactivate.call(this,f)}});return e},drag:function(a,e){if(a.options.refreshPositions){b.ui.ddmanager.prepareOffsets(a,e)}b.each(b.ui.ddmanager.droppables[a.options.scope],function(){if(this.options.disabled||this.greedyChild||!this.visible){return}var j=b.ui.intersect(a,this,this.options.tolerance);var c=!j&&this.isover==1?"isout":(j&&this.isover==0?"isover":null);if(!c){return}var h;if(this.options.greedy){var k=this.element.parents(":data(droppable):eq(0)");if(k.length){h=b.data(k[0],"droppable");h.greedyChild=(c=="isover"?1:0)}}if(h&&c=="isover"){h.isover=0;h.isout=1;h._out.call(h,e)}this[c]=1;this[c=="isout"?"isover":"isout"]=0;this[c=="isover"?"_over":"_out"].call(this,e);if(h&&c=="isout"){h.isout=0;h.isover=1;h._over.call(h,e)}})}}})(jQuery);(function($){$.fn.markItUp=function(settings,extraSettings){var options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;options={id:"",nameSpace:"",root:"",previewInWindow:"",previewAutoRefresh:true,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);if(!options.root){$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1]}})}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root)}return data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id){id='id="'+options.id+'"'}else{if($$.attr("id")){id='id="markItUp'+($$.attr("id").substr(0,1).toUpperCase())+($$.attr("id").substr(1))+'"'}}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"'}$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true&&$.browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(e){$("html").unbind("mousemove",mouseMove).unbind("mouseup",mouseUp);return false};$("html").bind("mousemove",mouseMove).bind("mouseup",mouseUp)});footer.append(resizeHandle)}$$.keydown(keyPressed).keyup(keyPressed);$$.bind("insertion",function(e,settings){if(settings.target!==false){get()}if(textarea===$.markItUp.focused){markup(settings)}});$$.focus(function(){$.markItUp.focused=this})}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=(button.key)?(button.name||"")+" [Ctrl+"+button.key+"]":(button.name||"");key=(button.key)?'accesskey="'+button.key+'"':"";if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul)}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-"}li=$('<li class="markItUpButton markItUpButton'+t+(i)+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu",function(){return false}).click(function(){return false}).mouseup(function(){if(button.call){eval(button.call)()}markup(button);return false}).hover(function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})},function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");if(altKey===true){return(b[1]!==undefined)?b[1]:b[0]}else{return(b[1]===undefined)?"":b[0]}});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true){return false}value=prompt(b[0],(b[1])?b[1]:"");if(value===null){abort=true}return value});return string}return""}function prepare(action){if($.isFunction(action)){action=action(hash)}return magicMarkups(action)}function build(string){openWith=prepare(clicked.openWith);placeHolder=prepare(clicked.placeHolder);replaceWith=prepare(clicked.replaceWith);closeWith=prepare(clicked.closeWith);if(replaceWith!==""){block=openWith+replaceWith+closeWith}else{if(selection===""&&placeHolder!==""){block=openWith+placeHolder+closeWith}else{block=openWith+(string||selection)+closeWith}}return{block:block,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:(selection||""),caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);if(ctrlKey===true&&shiftKey===true){prepare(clicked.beforeMultiInsert)}$.extend(hash,{line:1});if(ctrlKey===true&&shiftKey===true){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else{lines[i]=""}}string={block:lines.join("\n")};start=caretPosition;len=string.block.length+(($.browser.opera)?n:0)}else{if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len-=fixIeBug(string.block)}else{if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}}}if((selection===""&&string.replaceWith==="")){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else{caretOffset=-1}get();$.extend(hash,{line:"",selection:selection});if(ctrlKey===true&&shiftKey===true){prepare(clicked.afterMultiInsert)}prepare(clicked.afterInsert);prepare(options.afterInsert);if(previewWindow&&options.previewAutoRefresh){refreshPreview()}shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){if($.browser.opera){return string.length-string.replace(/\n*/g,"").length}return 0}function fixIeBug(string){if($.browser.msie){return string.length-string.replace(/\r*/g,"").length}return 0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else{$$.val($$.val().substring(0,caretPosition)+block+$$.val().substring(caretPosition+selection.length,$$.val().length))}}function set(start,len){if(textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&len==0){return false}range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else{if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len)}}textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if($.browser.msie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else{caretPosition=textarea.selectionStart}}else{caretPosition=textarea.selectionStart;selection=$$.val().substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open("","preview",options.previewInWindow)}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=="after"){iFrame.insertAfter(footer)}else{iFrame.insertBefore(header)}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}}else{if(altKey===true){if(iFrame){iFrame.remove()}previewWindow.close();previewWindow=iFrame=false}}if(!options.previewAutoRefresh){refreshPreview()}}function refreshPreview(){if(previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open();previewWindow.document.write(renderPreview());previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp}if(options.previewInWindow){previewWindow.focus()}}function renderPreview(){phtml="<html><head></head><body>"+$$.val()+"</body></html>";return phtml}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=(!(e.altKey&&e.ctrlKey))?e.ctrlKey:false;if(e.type==="keydown"){if(ctrlKey===true){li=$("a[accesskey="+String.fromCharCode(e.keyCode)+"]",header).parent("li");if(li.length!==0){ctrlKey=false;li.triggerHandler("mouseup");return false}}if(e.keyCode===13||e.keyCode===10){if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else{if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}}}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true){return false}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$$=$(this).unbind().removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$)})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])})}else{$("textarea").trigger("insertion",[options])}}})(jQuery);jQuery.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldY:0,build:function(a){this.each(function(){this.tableDnDConfig=jQuery.extend({onDragStyle:null,onDropStyle:null,onDragClass:"tDnD_whileDrag",onDrop:null,onDragStart:null,scrollAmount:5,serializeRegexp:/[^\-]*$/,serializeParamName:null,dragHandle:null},a||{});jQuery.tableDnD.makeDraggable(this)});jQuery(document).bind("mousemove",jQuery.tableDnD.mousemove).bind("mouseup",jQuery.tableDnD.mouseup);return this},makeDraggable:function(c){var b=c.tableDnDConfig;if(c.tableDnDConfig.dragHandle){var a=jQuery("td."+c.tableDnDConfig.dragHandle,c);a.each(function(){jQuery(this).mousedown(function(f){jQuery.tableDnD.dragObject=this.parentNode;jQuery.tableDnD.currentTable=c;jQuery.tableDnD.mouseOffset=jQuery.tableDnD.getMouseOffset(this,f);if(b.onDragStart){b.onDragStart(c,this)}return false})})}else{var e=jQuery("tr",c);e.each(function(){var f=jQuery(this);if(!f.hasClass("nodrag")){f.mousedown(function(g){if(g.target.tagName=="TD"){jQuery.tableDnD.dragObject=this;jQuery.tableDnD.currentTable=c;jQuery.tableDnD.mouseOffset=jQuery.tableDnD.getMouseOffset(this,g);if(b.onDragStart){b.onDragStart(c,this)}return false}}).css("cursor","move")}})}},updateTables:function(){this.each(function(){if(this.tableDnDConfig){jQuery.tableDnD.makeDraggable(this)}})},mouseCoords:function(a){if(a.pageX||a.pageY){return{x:a.pageX,y:a.pageY}}return{x:a.clientX+document.body.scrollLeft-document.body.clientLeft,y:a.clientY+document.body.scrollTop-document.body.clientTop}},getMouseOffset:function(e,c){c=c||window.event;var b=this.getPosition(e);var a=this.mouseCoords(c);return{x:a.x-b.x,y:a.y-b.y}},getPosition:function(c){var b=0;var a=0;if(c.offsetHeight==0){c=c.firstChild}while(c.offsetParent){b+=c.offsetLeft;a+=c.offsetTop;c=c.offsetParent}b+=c.offsetLeft;a+=c.offsetTop;return{x:b,y:a}},mousemove:function(h){if(jQuery.tableDnD.dragObject==null){return}var e=jQuery(jQuery.tableDnD.dragObject);var b=jQuery.tableDnD.currentTable.tableDnDConfig;var k=jQuery.tableDnD.mouseCoords(h);var g=k.y-jQuery.tableDnD.mouseOffset.y;var c=window.pageYOffset;if(document.all){if(typeof document.compatMode!="undefined"&&document.compatMode!="BackCompat"){c=document.documentElement.scrollTop}else{if(typeof document.body!="undefined"){c=document.body.scrollTop}}}if(k.y-c<b.scrollAmount){window.scrollBy(0,-b.scrollAmount)}else{var a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;if(a-(k.y-c)<b.scrollAmount){window.scrollBy(0,b.scrollAmount)}}if(g!=jQuery.tableDnD.oldY){var f=g>jQuery.tableDnD.oldY;jQuery.tableDnD.oldY=g;if(b.onDragClass){e.addClass(b.onDragClass)}else{e.css(b.onDragStyle)}var j=jQuery.tableDnD.findDropTargetRow(e,g);if(j){if(f&&jQuery.tableDnD.dragObject!=j){j.parentNode.insertBefore(jQuery.tableDnD.dragObject,j.nextSibling)}else{if(!f&&jQuery.tableDnD.dragObject!=j){j.parentNode.insertBefore(jQuery.tableDnD.dragObject,j)}}}}return false},findDropTargetRow:function(g,h){var k=jQuery.tableDnD.currentTable.rows;for(var f=0;f<k.length;f++){var j=k[f];var b=this.getPosition(j).y;var a=parseInt(j.offsetHeight)/2;if(j.offsetHeight==0){b=this.getPosition(j.firstChild).y;a=parseInt(j.firstChild.offsetHeight)/2}if((h>b-a)&&(h<(b+a))){if(j==g){return null}var c=jQuery.tableDnD.currentTable.tableDnDConfig;if(c.onAllowDrop){if(c.onAllowDrop(g,j)){return j}else{return null}}else{var e=jQuery(j).hasClass("nodrop");if(!e){return j}else{return null}}return j}}return null},mouseup:function(c){if(jQuery.tableDnD.currentTable&&jQuery.tableDnD.dragObject){var b=jQuery.tableDnD.dragObject;var a=jQuery.tableDnD.currentTable.tableDnDConfig;if(a.onDragClass){jQuery(b).removeClass(a.onDragClass)}else{jQuery(b).css(a.onDropStyle)}jQuery.tableDnD.dragObject=null;if(a.onDrop){a.onDrop(jQuery.tableDnD.currentTable,b)}jQuery.tableDnD.currentTable=null}},serialize:function(){if(jQuery.tableDnD.currentTable){return jQuery.tableDnD.serializeTable(jQuery.tableDnD.currentTable)}else{return"Error: No Table id set, you need to set an id on your table and every row"}},serializeTable:function(e){var a="";var c=e.id;var f=e.rows;for(var b=0;b<f.length;b++){if(a.length>0){a+="&"}var g=f[b].id;if(g&&g&&e.tableDnDConfig&&e.tableDnDConfig.serializeRegexp){g=g.match(e.tableDnDConfig.serializeRegexp)[0]}a+=c+"[]="+g}return a},serializeTables:function(){var a="";this.each(function(){a+=jQuery.tableDnD.serializeTable(this)});return a}};jQuery.fn.extend({tableDnD:jQuery.tableDnD.build,tableDnDUpdate:jQuery.tableDnD.updateTables,tableDnDSerialize:jQuery.tableDnD.serializeTables});function convertToMarkup(j){var e=0,a="",c=0,g=[];function h(l){switch(l){case"<p>":case"</p>":case"\n</p>":case"\n<p>":return"\n";case"<em>":return"''";case"\n<em>":return"\n''";case"\n</em>":return"\n''";case"</em>":return"''";case"<strong>":return"'''";case"\n<strong>":return"\n'''";case"\n</strong>":return"\n'''";case"</strong>":return"'''";case"\n<h1>":return"\n= ";case"</h1>":return" =";case"\n<h2>":return"\n== ";case"</h2>":return" ==";case"\n<h3>":return"\n=== ";case"</h3>":return" ===";case"\n<h4>":return"\n==== ";case"</h4>":return" ====";case"\n<h5>":return"\n===== ";case"</h5>":return" =====";case"\n<h6>":return"\n====== ";case"</h6>":return" ======";case"</a>":case"\n</a>":return"]";case"\n<hr>":return"\n----";case"<hr>":return"----\n";case"\n<ul>":case"<ul>":c++;g[c]="ul";return"";case"\n<ol>":case"<ol>":c++;g[c]="ol";return"";case"\n<br>":return"\n";case"\n</ol>":case"</ol>":case"\n</ul>":case"</ul>":c--;return"";case"\n</li>":case"</li>":return"";case"<br>":case"<code>":return"";case"</pre>":case"</code>":case"\n</code>":return"\n";case"\n<li>":case"<li>":a="";for(var k=0;k<c;k++){a=a+"    "}if(g[c]=="ol"){return"\n"+a+"a. "}else{return"\n"+a+"* "}case"\n<pre>":return"\n        ";default:a="";if(l.slice(0,4)=="\n<li"||l.slice(0,4)=="<li "){for(k=0;k<c;k++){a=a+"    "}return"\n"+a+l.split('"')[1]+". "}else{return l}}}function b(k){a=k.slice(1,k.length);return"\n["+a+"|"+a+"]"}function f(k){switch(k){case"</ol><ol>":case"</ol>\n<ol>":return"";case"</ul><ul>":case"</ul>\n<ul>":return"";case"</ul></li></ul>":case"</ul></li></ol>":return"</ul>";case"</ol></li></ol>":case"</ul></li></ol>":return"</ol>";default:return k}}if(j.length>0){j=j.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;");a=j.split(/<a href=\"/);j=a[0];if(a.length>1){for(e=1;e<a.length;e++){a[e]=a[e].replace(/">/,"|");j=j+"["+a[e]}}j=j.replace("<p>","").replace(/<\/strong><\/em><strong>/g,"''").replace(/<\/em><\/strong><em>/g,"'''").replace(/<\/p><.?l>/g,"\n<ol>").replace(/<\/p><ul>/g,"\n<ul>").replace(/\n */g,"\n").replace(/\n?<.*?>/g,h).replace(/ /g," ").replace(/\n\b((ftp|https?):\/\/\S*)/g,b).replace(/\n\n\n/g,"\n\n");while(j.length>0&&j.charAt(j.length-1).match(/\s/)){j=j.slice(0,j.length-1)}}return j}function convertToHTML(h){var u=0;var n=0;var o="";var m=[];var s=0;var w=false;function e(E,D,x){var C=0;while((E.length-4)%4>0){E=E.slice(1,E.length)}if(E.match(/\s{8}[^   ..|\* ..|\d\d?\. ?.]/)!=null){E="<pre><code>"+E.slice(E.length-4,E.length);return E}s=E.split("    ").length-1;var F="";switch(E.split("    ")[s].slice(0,1)){case"*":if(s==n){if(o=="ol"){F="</ol><ul>"}else{if(o==""){F="<ul>"}}}else{if(s>n){F="<ul>";m[m.length]="ul>";n=s}else{if(s<n){for(C=n;C>s;C--){F=F+"</"+m.pop()}}}}F=F+"<li>"+E.slice(E.length-2);o="ul";break;default:if(s==n){if(o=="ul"){F="</ul><ol>"}else{if(o==""){F="<ol>"}}}else{if(s>n){m[m.length]="ol>";F="<ol>";n=s}else{if(s<n){for(C=n;C>s;C--){F=F+"</"+m.pop()}}}}var B=E.slice(E.length-3).split(" ")[1];if(B==undefined){B=""}F=F+"<li>"+B;o="ol";break}return F}function t(C){function B(x){switch(x){case"\n=":case"<p>=":case"=</p>":case"=":return"h1>";case"\n==":case"<p>==":case"==</p>":case"==":return"h2>";case"\n===":case"<p>===":case"===</p>":case"===":return"h3>";case"\n====":case"<p>====":case"====</p>":case"====":return"h4>";case"\n=====":case"<p>=====":case"=====</p>":case"=====":return"h5>";case"\n======":case"<p>======":case"======</p>":case"======":return"h6>"}}var y=C.split(" ");y[0]="<"+B(y[0]);y[(y.length-1)]="</"+B(y[(y.length-1)]);C=y.join("");return C}function c(C){var B=C.slice(0,7);var D=C.slice(7,C.length-4);D=D.replace(/></g,">\n<");switch(B){case"<p><ul>":B="<ul>\n";break;case"<p><ol>":B="<ol>\n";break;case"</ol><p>":B="</ol>";break;case"</ul><p>":B="</ul>";break}B=B+D;return B}function z(x){return x+"\n"}function q(C){var B=C.slice(0,5);B=B+"\n<p>";var x=C.slice(5,C.length-6);var D=C.slice(C.length-1);if(D=="\n"){C=B+x+"</p>"+D}else{C=B+x+"<br>"+D}return C}function f(x){return"\n<p>"+x.slice(5,x.length)}function A(x){return x.slice(0,1)+"<br>\n"}function v(x){return"<hr>\n<p>"+x.slice(9,x.length-4)+"</p>"}function a(x){return"</p>"+x.slice(8,x.length)}function r(x){switch(x){case"<li>\n":return"<li>";case"<p>\n":return"<p>"}}function b(x){return x.slice(0,1)+"\n<li"}if(h.length>0){h=h.replace(/.<li/g,b);var k=h.split("\n");h="";for(u=0;u<k.length;u++){if(k[u].split(/\s{4}\s*..../).length==1){if(w===true){for(d=m.length;d>0;d--){if(d==1){k[u]="</"+m.shift()+"\n\n"+k[u]}else{k[u]="</"+m.shift()+k[u]}}n=0}}else{k[u]=k[u].replace(/\s{4}\s*..../g,e);w=true}switch(k[u].slice(0,4)){case"<pre":k[u]="\n"+k[u]+"</code></pre>";break;case"<li>":case"<ol>":case"<ul>":case"</ol":case"</ul":case"<li ":k[u]=k[u]+"</li>";break;default:}if(u<k.length-1&&k[u].match(/^[\w|"|']/)!=null&&k[u].match(/^[\w|"|']/)!=null&&k[u].length>0&&k[u+1].length>0){h=h+k[u]+"<br>"}else{if(u<k.length-1&&k[u].match(/>$/)!=null&&k[u].match(/^</)!=null){h=h+k[u]}else{if(k[u].match(/-{4}/)!=null){h=h+"<hr>"}else{h=h+k[u]+"\n"}}}}h=h.replace(/\n\n/g,"</p>\n<p>");h=h.replace(/\n/g,"<br>");h="<p>"+h+"</p>";var l=h.split(/\[/);if(l.length>1){h=l[0];for(u=1;u<l.length;u++){if(l[u].indexOf("|")>-1){var j=l[u].split(/\|/);l[u]='<a href="'+j[0]+'">'+j[1].replace(/\]/,"</a>")}else{l[u]='<a href="'+l[u]+'">'+l[u]+"</a>"}h=h+l[u]}}var p=false;var g=false;for(u=0;u<h.length;u++){if(h.charAt(u)=="'"){if(h.charAt(u+1)=="'"){if(h.charAt(u+2)=="'"){if(p==false){h=h.slice(0,u)+"<strong><X>"+h.slice((u+3));u+=3;p=true}else{h=h.slice(0,u)+"</strong><X>"+h.slice((u+3));u+=3;p=false}}else{if(g==false){h=h.slice(0,u)+"<em><X>"+h.slice((u+2));u+=2;g=true}else{h=h.slice(0,u)+"</em><X>"+h.slice((u+2));u+=2;g=false}}}}}while(h.length>0&&h.charAt(h.length-1).match(/\s/)){h=h.slice(0,h.length-1)}h=h.replace(/<p><\/p>\n<p>/g,"<p>").replace(/<\/h\d>/g,z).replace(/.<br>/g,A).replace(/\n?<X>\n?/g,"").replace(/\n<ol>/g,"<ol>").replace(/\n<ul>/g,"<ul>").replace(/<\/p>\n?<br>/g,"</p>").replace(/<p>\n<hr>/g,"<hr>").replace(/\n<br>.*<\/p>/g,f).replace(/\n<br>/g,"<br>\n").replace(/<hr><br>\n.*<br>/g,v).replace(/<br>\n\n/g,"<br>\n").replace(/<\/p>\n<p><(o|u)l>\n<li>/g,a).replace(/<(li|p)>\n/g,r).replace(/<\/p>\n\n/g,"</p>\n").slice(0,h.length-5).replace(/\n?<p>\n?<br>\n?<pre>\n?/g,"\n<pre>").replace(/\n?<\/pre>\n?<br>\n?<\/ol>\n?(<\/li>)?\n?/g,"</pre>\n").replace(/<\/pre>\n<br>/g,"</pre>").replace(/=<br>/g,"=\n").replace(/<p>=/g,"=").replace(/=<\/p>/g,"=").replace(/(<p>={1,6}\s.+=\s{1,6}<\/p>)|(^={1,6}\s.+\s={1,6}$)/gm,t).replace(/<\/p><ul>/g,"</p>\n<ul>").replace(/<\/p><ol>/g,"</p>\n<ol>")}return h}var experimental=false;var charMap={characters:{name:"Characters",className:"characters",dropMenu:[]},symbols:{name:"Symbols",className:"symbols",dropMenu:[]}};var MusicBrainz={artistData:new Object(),roundness:"round 6px",markup:{wiki:{nameSpace:"wiki",onTab:{keepDefault:false,openWith:"    "},markupSet:[{name:"Bold",className:"editor strong",key:"b",openWith:"'''",closeWith:"'''",placeHolder:"( "+text.InsertTextBold+" )"},{name:"Italic",className:"editor em",key:"i",openWith:"''",closeWith:"''",placeHolder:"( "+text.InsertTextItalic+" )"},{separator:"---------------"},{name:"Heading 1",className:"editor h1",key:"1",openWith:"= ",closeWith:" =",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 2",className:"editor h2",key:"2",openWith:"== ",closeWith:" ==",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 3",className:"editor h3",key:"3",openWith:"=== ",closeWith:" ===",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 4",className:"editor h4",key:"4",openWith:"==== ",closeWith:" ====",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 5",className:"editor h5",key:"5",openWith:"===== ",closeWith:" =====",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 6",className:"editor h6",key:"6",openWith:"====== ",closeWith:" ======",placeHolder:"( "+text.InsertTitle+" )"},{separator:"---------------"},{name:"Hard rule",className:"editor hr",openWith:"\n----\n"},{name:"Paragraph",className:"editor p",openWith:"\n",closeWith:"\n"},{name:"Preformatted Text",className:"editor precode",openWith:"        ",placeHolder:"( "+text.InsertTextPreformat+" )"},{name:"Link to URL",key:"l",className:"editor a",openWith:"[[![Url:!:http://]!]|",closeWith:"]",placeHolder:"( "+text.InsertTextURL+" )"},{separator:"---------------"},{name:"Bulleted list",className:"editor ul",replaceWith:function(a){var b=a.selection;b=b.replace(/^\s{4}[\*(a.)]\s/gm,"");b="    * "+b.replace(/\n/g,"\n    * ")+"\n";return b.replace(/\n$/g,"")}},{name:"Numbered list",className:"editor ol",replaceWith:function(a){var b=a.selection;b=b.replace(/^\s{4}[\*(a.)]\s/gm,"");b="    a. "+b.replace(/\n/g,"\n    a. ")+"\n";return b.replace(/\n$/g,"")}},{separator:"---------------"},charMap.characters,charMap.symbols,{separator:"---------------"},{name:"Preview",className:"preview",call:"preview",afterInsert:function(){setTimeout(function(){var a=$(".markItUpPreviewFrame")[0].contentWindow.document;a.open().close();$("body",a).append(convertToHTML($("#annotation").val().replace(/^(\s{4,})a\.\s/gm,"$11. ").replace(/<ol>/g,'<ol type="1">')))},1)}}]},html:{nameSpace:"html",onTab:{keepDefault:false,openWith:"    "},markupSet:[{name:"Bold",className:"editor strong",key:"b",openWith:"<strong>",closeWith:"</strong>",placeHolder:"( "+text.InsertTextBold+" )"},{name:"Italic",className:"editor em",key:"i",openWith:"<em>",closeWith:"</em>",placeHolder:"( "+text.InsertTextItalic+" )"},{separator:"---------------"},{name:"Heading 1",className:"editor h1",key:"1",openWith:'<h1(!( class="[![Class]!]")!)>',closeWith:"</h1>",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 2",className:"editor h2",key:"2",openWith:'<h2(!( class="[![Class]!]")!)>',closeWith:"</h2>",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 3",className:"editor h3",key:"3",openWith:'<h3(!( class="[![Class]!]")!)>',closeWith:"</h3>",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 4",className:"editor h4",key:"4",openWith:'<h4(!( class="[![Class]!]")!)>',closeWith:"</h4>",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 5",className:"editor h5",key:"5",openWith:'<h5(!( class="[![Class]!]")!)>',closeWith:"</h5>",placeHolder:"( "+text.InsertTitle+" )"},{name:"Heading 6",className:"editor h6",key:"6",openWith:'<h6(!( class="[![Class]!]")!)>',closeWith:"</h6>",placeHolder:"( "+text.InsertTitle+" )"},{separator:"---------------"},{name:"Hard rule",className:"editor hr",openWith:"<hr/>"},{name:"Paragraph",className:"editor p",openWith:"<p>",closeWith:"</p>"},{name:"Preformatted Text",key:"c",className:"editor precode",openWith:"<pre><code>",closeWith:"</pre></code>",placeHolder:"( "+text.InsertTextPreformat+" )"},{name:"Link to URL",key:"l",className:"editor a",openWith:'<a href="[![Link:!:http://]!]">',closeWith:"</a>",placeHolder:"( "+text.InsertTextURL+" )"},{separator:"---------------"},{name:"Bulleted List",className:"editor ul",openWith:"<ul>\n",closeWith:"\n</ul>",replaceWith:function(a){var b=a.selection;b=b.replace(/(<\/?li>|<\/?[uo]l>)/g,"");b="    <li>"+$.trim(b).replace(/\n/g,"</li>\n    <li>")+"</li>";return b}},{name:"Numbered List",className:"editor ol",openWith:"<ol>\n",closeWith:"\n</ol>",replaceWith:function(a){var b=a.selection;b=b.replace(/(<\/?li>|<\/?[uo]l>)/g,"");b="    <li>"+$.trim(b).replace(/\n/g,"</li>\n    <li>")+"</li>";return b}},{name:"List Item",className:"editor li",openWith:"    <li>",closeWith:"</li>\n",placeHolder:"( "+text.InsertListItem+" )"},{separator:"---------------"},charMap.characters,charMap.symbols,{separator:"---------------"},{name:"Preview",className:"preview",call:"preview"}]}},activateAnnotationSwitcher:function(){$("#ChangeMarkup li:not(:first)").click(function(){$("#ChangeMarkup li").removeClass("currentSet");newSet=$(this).attr("class");$(this).addClass("currentSet");$("#annotation").markItUpRemove();switch(newSet){case"wiki":$("#annotation").val(convertToMarkup($("#annotation").val()));$("#annotation").markItUp(MusicBrainz.markup.wiki);break;case"html":$("#annotation").val(convertToHTML($("#annotation").val().replace(/^(\s{4,})a\.\s/gm,"$11. ").replace(/<ol>/g,'<ol type="1">')));$("#annotation").markItUp(MusicBrainz.markup.html);break;default:}return false})},addAnnotationButton:function(){MusicBrainz.addToolButton(text.AnnotationEditorShow,"btnAnnotationEditor");$("#btnAnnotationEditor").click(function(){if($(this).val()==text.AnnotationEditorShow){$(".annotationFS").show();$(this).val(text.AnnotationEditorHide)}else{$(".annotationFS").hide();$(this).val(text.AnnotationEditorShow)}})},addAnnotationSwitcher:function(){$("#annotation").before('<ul id="ChangeMarkup"><li>'+text.MarkupLanguage+' </li><li class="wiki currentSet"><a href="#">'+text.Wiki+'</a></li><li class="html"><a href="#">'+text.HTML+"</a></li></ul>");if(experimental){$("#annotation").before("<br/><br/><em>Note: Converting from HTML to Wikiformat and editing using HTML mode are both experimental at the moment!</em>")}},addSingleArtist:function(c){var a=$(c).parents("table:first"),f=a.find(".addartist"),b=0,e=parseInt($(c).attr("id").replace("btnAddTA-",""),10);a.find(".joinerlabel strong, .joiner").removeClass("hidden");$(f).filter(":last").after(MusicBrainz.makeHTMLNewArtist(e,b));MusicBrainz.updateComboArtist($(f[0]));MusicBrainz.updateJoinPhrases(a.find(".addartist"))},addToolButton:function(b,a){$("#editMenuControlsInline").append('<input type="button" id="'+a+'" value="'+b+'"/>');$("#editMenuControlsInline").show();MusicBrainz.setPulloutHeight()},attachHelpButtonEvents:function(a){$.each(a,function(b){$(a[b][0]+" img").click(function(){$("#wikiDocName").html(a[b][1]);$("#wikiHelp").html("").slideDown();setTimeout(function(){$("#wikiHelp").lorem({type:"words",amount:"500",ptags:true});$("#wikiHelpBox").slideDown(1000)},1000)})})},clearHelpMsg:function(){$("#editHelpMsg").html("")},clearStatus:function(){$("#editStatusMsg").html("")},hideErrorForSidebar:function(a){$("#"+a+"-dt").btOff()},makeEditMenu:function(){$("body").append(mb.HTMLsnippets.sideMenu);$("#editMenuPullout").corner(MusicBrainz.roundness+" tr").corner(MusicBrainz.roundness+" br").mouseover(function(){$("#editMenuPullout").hide();$("#editMenu").unbind("mouseleave").stop().animate({width:"17em"},"slow").children().show();setTimeout(function(){$("#editMenu").mouseleave(function(){$("#editMenu").animate({width:"0px"},"slow",function(){$("#editMenu").children().hide();$("#editMenuPullout").show();$("#editMenu").hide()})})},250)});$("#editMenu").hide();$("#editMenuPullout, #editMenu").css("top",$("#editToggle").offset().top+20);if(!$.browser.safari&&!$.browser.opera){$("#select-edit-release-country").hoverIntent({interval:1,sensitivity:1,timeout:300,over:function(){$(this).removeClass("width100","normal").addClass("shiftSelect","normal")},out:function(){$(this).addClass("width100","normal").removeClass("shiftSelect","normal")}}).change(function(){$(this).addClass("width100","fast").removeClass("shiftSelect","fast")})}},makeCountryList:function(){var a=$("#select-edit-release-country");$.each(mb.country,function(b){a.addOption(mb.country[b][0],mb.country[b][1]);if($.browser.mozilla){a.children(":last").before($("<optgroup/>").css({background:"url(/static/images/icon/flags.png) no-repeat "+mb.country[b][3]+"px"}).addClass("icon"))}})},makeFormatList:function(){var a,b=$("#select-edit-release-format");$.each(mb.format,function(c){if(mb.format[c][0]!=13){b.addOption(mb.format[c][0],mb.format[c][2])}else{a=c}b.children(":last").data("start_date",mb.format[c][1])});b.sortOptions().val("").addOption(mb.format[a][0],mb.format[a][2]);MusicBrainz.setHoverMsg([["#select-edit-release-format option:last",text.GenericOther.replace("I18N-selectlist-I18N",text.FieldFormat)]]);b.children(":last").data("start_date","");b.children(":first").attr("selected","selected")},makeHTMLNewArtist:function(c,b,a,e){b=(typeof(b)=="undefined")?0:b;a=(typeof(a)=="undefined")?"":a;e=(typeof(e)=="undefined")?"":e;return'<tr class="editartist addartist '+c+'"><td class="empty"><img src="/static/images/blank.gif" class="removeArtist"  alt="'+text.RemoveArtist+'" title="'+text.RemoveArtist+'"/><input id="ta-name-'+c+'" type="text" class="name" value="'+a+'"/></td><td class="joiner"><input id="ta-joiner-'+c+'" type="text" class="joiner" value="'+e+'"/></td></tr>'},makeStatusAndDocsBox:function(){$(".tabs:eq(0)").after(mb.HTMLsnippets.docsBox);$("#wikiHelpBox").corner(MusicBrainz.roundness);$("#wikiHelpInnerBox").corner(MusicBrainz.roundness)},makeSwappableSelectList:function(b,e,g,a){var c="#select-edit-"+b+"-"+e,f="btn-switch-"+e+"-list";$("."+b+"-"+e+":not(dt)").toggle();$(c).after('<input type="button" value="'+text.FullList+'" id="'+f+'"/>');f="#"+f;$(f).addClass("rightsidebutton").click(function(){MusicBrainz.swapShortLongList($(c),$(f),g,a)});MusicBrainz.setHoverMsg([[f,text.hoverSwapList]]);$(f).mouseout(function(){MusicBrainz.clearHelpMsg()})},makeTogglable:function(a){$.each(a,function(){var b=this;$(".editable."+b).click(function(){$("."+b+":not(dt)").toggle()})})},makeTogglableEachInGroup:function(a){$.each(a,function(){var b=this;$(".editable."+b[0]).each(function(c){$(this).click(function(){$(".editable."+b[0]+":eq("+c+")").hide();if(typeof(b[1])!="undefined"){if(b[1]){$(".hidden."+b[0]+":eq("+c+") textarea").autogrow({minHeight:10})}}if(typeof(b[2])!="undefined"){$(".hidden."+b[2]+"."+c).show()}$(".hidden."+b[0]+":eq("+c+")").show()})})})},populateCharArrays:function(){chars=[["",1],["",1],["",3],["",2],["",1],["",0],["",2],["",0],["",1],["",3],["",0],["",0],["",1],["",1],["",3],["",2],["",1],["",0],["",2],["",0],["",1],["",3],["",0],["",0],["",3],["",2],["",0],["",3],["",0],["",0],["",0],["",2],["",0],["",0],["",0],["",4],["",3],["",2],["",0],["",3],["",0],["",0],["",0],["",2],["",0],["",0],["",0],["",4],["",1],["",0],["",0],["",1],["",0],["",0],["",0],["",4],["",3],["",1],["",1],["",1],["",1],["",1],["",0],["",0],["",1],["",0],["",0],["",0],["",4],["",3],["",1],["",1],["",1],["",1],["",3],["",3],["",2],["",2],["",5],["",3],["",1],["",3],["",3],["",2],["",2],["",5],["",3],["",1],["",3],["",3],["",4],["",0],["",5],["",3],["",1],["",3],["",3],["",4],["",0],["",5],["",3],["",1],["",1],["",0],["",0],["",1],["",3],["",0],["",1],["",3],["",0],["",0],["",6],["",1],["",0],["",0],["",1],["",3],["",0],["",1],["",3],["",0],["",0],["",6],["",1],["",0],["",0],["",3],["",1],["",1],["",0],["",2],["",0],["",0],["",0],["",4],["",0],["",1],["",0],["",0],["",3],["",1],["",1],["",0],["",2],["",0],["",0],["",0],["",4],["",0],["",2],["",0],["",3],["",5],["",5],["",3],["",1],["",2],["",0],["",3],["",5],["",5],["",3],["",1],["",3],["",1],["",1],["",5],["",5],["",5],["",3],["",1],["",1],["",5],["",5],["",5],["",1],["",1],["",1],["",1],["",16],["",0],["",1],["",1],["",1],["",1],["",16],["",0],["",3],["",3],["",5],["",5],["",4],["",0],["",3],["",3],["",5],["",5],["",4],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",16],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0],["",0]];for(var a=0;a<chars.length;a++){charMap.characters.dropMenu[a]={name:chars[a][0],openWith:chars[a][0],className:"skip"+chars[a][1]}}symbols=["","","","","","","","","","","","","","","","","","","","","","","","","","","","$","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""];for(var a=0;a<symbols.length;a++){charMap.symbols.dropMenu[a]={name:symbols[a],openWith:symbols[a],className:"skip0"}}charMap.symbols.dropMenu[charMap.symbols.dropMenu.length]={name:"[",openWith:"&91;",className:"skip0"};charMap.symbols.dropMenu[charMap.symbols.dropMenu.length]={name:"]",openWith:"&93;",className:"skip0"}},setHelpMsg:function(a){$("#editHelpMsg").html(a)},setHoverMsg:function(a){$.each(a,function(b){$(a[b][0]).mouseover(function(){MusicBrainz.setHelpMsg(a[b][1])})})},setPulloutHeight:function(){var a=($("#editMenu").height()+10)+"px";$("#editMenuPullout").css({height:a,lineHeight:a})},setStatus:function(a,b){if(b){a='<img src="/static/images/loading-small.gif">&nbsp;'+a}$("#editStatusMsg").html(a)},showErrorForSidebar:function(b,a){$("#"+b+"-dt").bt(a,{spikeLength:30,positions:"left",fill:"#FEEECD",trigger:"",shrinkToFit:"true"}).btOn()},stripeTracks:function(){$("table.tbl > tbody").each(function(){$(this).children("tr").removeClass("ev").filter(":visible:even").addClass("ev")})},swapShortLongList:function(a,e,c,b){if(typeof(a.selectedValues()[0])!="undefined"){var f=a.selectedValues()[0]}a.hide();a.removeOption(/./);if(e.attr("value")==text.FullList){e.attr("value",text.ShortList);a.addOption(b,false)}else{e.attr("value",text.FullList);if($.inArray(parseInt(f,10),c)==-1&&typeof(f)!="undefined"){if(typeof(b[f])!="undefined"){a.addOption(f,b[f])}}$.each(c,function(){a.addOption(parseInt(this,10),b[parseInt(this,10)])})}a.addOption("","[ "+text.Select+" ]",false);a.val(f);a.show()},updateComboArtist:function(b){var a=$(b).parents("table:first"),c="",e=a.find(".removeArtist");$(a).find("input[type=text]:not(:last)").each(function(g){var f=$.trim($(this).val());if(g%2){c+=(f==",")?"":" ";c+=(f+" ")}else{c+=f}});a.find("textarea:first").val($.trim(c));if(e.length==1){e.hide()}else{e.show()}},updatePositionFields:function(){$(".tbl.release > tbody").each(function(){var b=$($(this).find(".editable.trackposition")),c=$($(this).find('.trackposition:not(".editable")')),e=$(this).find(".editable.trackposition").length;for(var a=0;a<e;a++){if($(b[a]).text()!=a+1){}}})},updateJoinPhrases:function(a){var b=a.length;a.find("input.joiner").show().filter(":last").hide().val("").end().filter(":visible").each(function(f){var c=$(this).val(),e="";if(c=="&"||c==","||c.length===0){e=",";if(b==2){e="&"}else{if(b>2&&f==(b-2)){e="&"}}$(this).val(e)}})},};$(function(){$(".editable a").bind("click.blocked",function(a){a.preventDefault()});MusicBrainz.makeTogglable([["release-date"],"release-format","release-packaging","release-status"]);$(".editable, .artistDisplay td:has(textarea)").each(function(a){$(this).css("cursor","pointer")});$("#select-edit-release-packaging").addOption(mb.packaging,false);$("#select-edit-release-status").addOption(mb.releasestatus,false);MusicBrainz.makeFormatList();$("#select-edit-release-language").addOption($("#edit-release-language-value").val(),"");MusicBrainz.swapShortLongList($("#select-edit-release-language"),$("#btn-switch-language-list"),mb.commonLangs,mb.language);$("#select-edit-release-script").addOption($("#edit-release-script-value").val(),"");MusicBrainz.swapShortLongList($("#select-edit-release-script"),$("#btn-switch-script-list"),mb.commonScripts,mb.script);$(".editable.release-language").click(function(){MusicBrainz.makeSwappableSelectList("release","language",mb.commonLangs,mb.language)});$(".editable.release-script").click(function(){MusicBrainz.makeSwappableSelectList("release","script",mb.commonScripts,mb.script)});$(".btnAddTA").live("click",function(){MusicBrainz.addSingleArtist(this)});$(".addartist input").live("keyup",function(){MusicBrainz.updateComboArtist(this)}).live("paste",function(){var a=this;setTimeout(function(){MusicBrainz.updateComboArtist(a)},1)});MusicBrainz.makeTogglableEachInGroup([["trackposition"],["trackname",true],["trackartist",true,"editartist"],["trackdur"]]);$(".artistDisplay").live("click",function(){$(".artistDisplay").each(function(){$(this).parents("table:first").find("tr:not(:first)").hide().end().find("tr:first").addClass("notActive")});$(this).parents("table:first").find("tr").show().filter(":first").removeClass("notActive")});MusicBrainz.makeTogglable(["release-barcode","release-catalog","release-country","release-label"]);MusicBrainz.makeCountryList()});MusicBrainz.initializeTrackParser=function(){$(".tbl.release").before(mb.HTMLsnippets.trackParser);MusicBrainz.addToolButton(text.TrackParserShow,"btnTrackParser");$("#btnTrackParser").click(function(){if($(this).val()==text.TrackParserShow){$("#js-fieldset-tp").show();$(this).val(text.TrackParserHide)}else{$("#js-fieldset-tp").hide();$(this).val(text.TrackParserShow)}});$("#tp-textarea").autogrow({minHeight:30})};$(function(){});

